<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="../../../public/css/bootstrap.min.css">

		<link rel="stylesheet" type="text/css" href="../../../public/layui/css/layui.css" />
		<link rel="stylesheet" type="text/css" href="../../../public/css/style.css" />
		<style type="text/css">
			.layui-border-box {
				width: 100% !important;
				margin: 0;
			}
			
			.layui-table-body {
				background: #FFFFFF;
			}
			
			.left_silde>ul,
			#fengMap {
				min-height: 1210px;
			}
			
			.laytable-cell-1-230 {
				width: 100px !important;
			}
			
			.layui-nav-child {
				z-index: 999999999999;
			}
		</style>
	</head>

	<body class="clearfix">
		<div id="header">

		</div>

		<div class="content">
			<div class="left_silde " style="width: 10%;float: left;">
				<ul class="layui-nav layui-nav-tree layui-inline" lay-filter="demo" style="width: 100%;">
					<li class="layui-nav-item  layui-nav-itemed">
						<a href="javascript:;">报警信息</a>
						<dl class="layui-nav-child">

							<dd class="">
								<a href="javascript:;">报警列表</a>
							</dd>
						</dl>
					</li>
				</ul>
			</div>
			<div id=" " class="min l" style="width: 88%;float: left;">
				<div class="minCont" style="padding: 3% 0 ">
					<table id="test" lay-filter="test"></table>
					<script type="text/html" id="demo">
						<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除报警</a>
					</script>
				</div>
			</div>
		</div>
		<script src=" ../../../public/js/jquery.js"></script>
		<script src="../../red/js/header.js" type="text/javascript" charset="utf-8"></script>
		<script src=" ../../../public/layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
		<script>
			var datas = [];
			layui.use('table', function() {
				var table = layui.table;
				table.render({
					elem: '#test',
					url: '/api/alarm/getall',
					toolbar: '#toolbarDemo',
					request: {
						pageName: 'currentPage' //页码的参数名称，默认：page
							,
						limitName: 'pageSize' //每页数据量的参数名，默认：limit
					},
					parseData: function(res) { //res 即为原始返回的数据
						var rows = res.pagedData.datas;

						if(res.success == true) {
							res.success = 0
						};
						for(var a = 0; a < rows.length; a++) {

							console.log(rows[a])
							datas.push(rows[a])

						}
						console.log(datas)
						return {
							"code": res.success, //解析接口状态
							"msg": res.message, //解析提示文本
							"count": res.pagedData.totalCount, //解析数据长度
							"data": datas //解析数据列表
						};
					},
					done: function(res, curr, count) {
						console.log(res)
					},
					title: '用户数据表',
					totalRow: true,
					cols: [
						[{
								field: 'id',
								title: '报警ID',
								width: "7%",
								templet: '#arid'
							}, {
								field: 'tagNo',
								title: '报警标签',
								width: "13%",
								templet: '#artagNo',
							}, {
								field: 'baseNo',
								title: '基站编号',
								width: "13%",
								templet: '#baseNo'

							}, {
								field: 'type',
								title: '报警类型',
								width: "10%",
								templet: '#type'

							}, {
								field: 'alarmTime',
								title: '时间',
								width: "15%",
								templet: '#department'

							},
							{
								field: 'alarmMsg',
								title: '报警信息',
								width: "20%",
								templet: '#job'

							}, {
								fixed: 'right',
								title: '操作',
								width: "13%",
								toolbar: '#demo'
							}
						]
					]
				});
				table.on('tool(test)', function(obj) {
					var data = obj.data;
					if(obj.event === 'del') {
						layer.confirm('真的删除行么', function(index) {
							DeleteBook(data.id)
							layer.close(index);
						});
					} else if(obj.event === 'edit') {
						EditBook(data.id)
					}
				});

			});

			function DeleteBook(id) {
				$.ajax({
					url: "/api/alarm/deleteAlarm?id=" + id,
					type: "post",
					contentType: "application/json",
					data: {
						id: id
					},
					success: function(red) {
						console.log(red)
						if(red.success == true) {
							alert(red.message)
							//								location.reload();
						} else {
							alert("服务繁忙，请重试")
						}
					}
				})

			}
		</script>
	</body>

</html>