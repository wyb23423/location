<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="../../../public/css/bootstrap.min.css">

		<link rel="stylesheet" type="text/css" href="../../../public/layui/css/layui.css" />
		<link rel="stylesheet" type="text/css" href="../../../public/css/style.css" />
		<style type="text/css">
			.layui-border-box {
				width: 100% !important;
				margin: 0;
			}
			
			.layui-table-body {
				background: #FFFFFF;
			}
			
			.minCont>div {
				padding: 4%;
			}
		</style>
	</head>

	<body class="clearfix">
		<div id="header">

		</div>

		<div class="content">
			<div class="left_silde layui-col-xs1">
				<ul class="layui-nav layui-nav-tree layui-inline" lay-filter="demo" style="width: 100%;">
					<li class="layui-nav-item layui-nav-itemed">
						<a href="admin.html">管理员</a>
					</li>

					<li class="layui-nav-item ">
						<a href="addAdmin.html">增加人员</a>
					</li>
					<li class="layui-nav-item">
						<a href="Permission.html">权限管理</a>
					</li>
				</ul>
			</div>
			<div id=" " class="min layui-col-xs11">
				<div class="minCont">

					<table id="test" lay-filter="test"></table>
					<script type="text/html" id="demo">
						<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除标签</a>
						<!--<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">配置标签</a>-->
					</script>
				</div>
			</div>
		</div>
		<script src=" ../../../public/js/jquery.js"></script>
		<script src="../../red/js/header.js" type="text/javascript" charset="utf-8"></script>
		<script src=" ../../../public/layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
		<script>
			var datas = [];
			layui.use('table', function() {
				var table = layui.table;
				table.render({
					elem: '#test',
					url: '/api/admin/getall',
					toolbar: '#toolbarDemo',
					height: "500",
					request: {
						pageName: 'currentPage' //页码的参数名称，默认：page
							,
						limitName: 'pageSize' //每页数据量的参数名，默认：limit
					},
					parseData: function(res) { //res 即为原始返回的数据
						var rows = res.pagedData.datas;
						if(res.success == true) {
							res.success = 0
						};
						for(var a = 0; a < rows.length; a++) {
							console.log(rows[a])
							datas.push(rows[a])
						}
						return {
							"code": res.success, //解析接口状态
							"msg": res.message, //解析提示文本
							"count": res.pagedData.totalCount, //解析数据长度
							"data": datas //解析数据列表
						};
					},
					done: function(res, curr, count) {
						console.log(res)
					},
					title: '用户数据表',
					totalRow: true,
					cols: [
						[{
							type: 'checkbox'
						}, {
							field: 'id',
							title: 'ID',
							width: "8%",
							sort: true
						}, {
							field: 'adminName',
							title: '管理员名称',
							width: "12%",
							templet: '#usernameTpl'
						}, {
							field: 'sex',
							title: '性别',
							width: "6%",
							templet: '#switchTpl',
							unresize: true
						}, {
							field: 'department',
							title: '部门',
							width: "11%",

						}, {
							field: 'job',
							width: "14%",
							title: '职位',

						}, {
							field: 'level',
							title: '等级T',
							width: "8%",
							sort: true
						}, {
							field: 'phone',
							width: "10%",
							title: '电话号码',
						}, {
							field: 'workNo',
							title: '工号',
							width: "6%",

						}, {
							field: '操作',

							width: "15%",
							align: 'center',
							title: '操作',
							toolbar: '#demo'
						}]
					],

				});
				table.on('tool(test)', function(obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
					var data = obj.data; //获得当前行数据
					var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
					var tr = obj.tr; //获得当前行 tr 的DOM对象
					if(layEvent === 'del') { //删除
						layer.confirm('确认删除该管理员？', function(index) {
							obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
							layer.close(index);
							DeleteBook(data.id)
						});
					} 
				});
				
			});

			function EditBook(id) {
				alert("是否编辑设备：ID" + id);
				console.log(this)
				$("#exampleModal").modal("toggle")
				tagid = id

			}
			//删除操作
			function DeleteBook(id) {
				$.ajax({
					url: "/api/admin/deleteAdmin?id=" + id,
					type: "post",
					contentType: "application/json",
					data: {
						id: id
					},
					success: function(red) {
						console.log(red)
						if(red.success == true) {
							alert(red.message)
							//								location.reload();
						} else {
							alert("服务繁忙，请重试")
						}
					}
				})

			}
		</script>
	</body>

</html>