(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["map"],{"0a43":function(t,e,a){"use strict";var n=a("957f"),i=a.n(n);e["default"]=i.a},1896:function(t,e,a){"use strict";var n=a("60f5"),i=a.n(n);e["default"]=i.a},"2a87":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-left":"5%","padding-top":"3%"}},[a("h3",{staticStyle:{color:"#009688"}},[t._v("\n        地图编辑\n    ")]),a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"选择地图"}},[a("map-select",{on:{selectmap:t.selectMap}})],1),a("el-form-item",[t.permission.delete?a("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:t.del}},[t._v("\n                删除\n            ")]):t._e()],1)],1),a("div",{staticClass:"el-divider el-divider--horizontal",staticStyle:{width:"95%","background-color":"#e00"}}),t.permission.post?a("map-form",{attrs:{data:t.map},on:{submit:t.onSubmit,"update:data":function(e){t.map=e}}}):t._e()],1)},i=[],r=a("cebc"),o=(a("28a5"),a("bd86")),s=(a("aef6"),a("7f7f"),a("d225")),l=a("b0b4"),c=a("308d"),u=a("6bb5"),p=a("4e2b"),f=a("9ab4"),d=a("2fe1"),h=a("2b0e"),m=a("61fd"),b=a("b20a"),v=a("60a3"),g=function(t){function e(){var t;return Object(s["a"])(this,e),t=Object(c["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.map={},t}return Object(p["a"])(e,t),Object(l["a"])(e,[{key:"selectMap",value:function(t){var e=t.margin;this.map=Object(o["a"])({id:t.id,name:t.name,minX:e[0][0],maxX:e[2][0],minY:e[0][1],maxY:e[2][1],width:e[4][0],height:e[4][1]},t.filepath.endsWith(".fmap")?"filename":"url",t.filepath)}},{key:"del",value:function(){var t=this;null!=this.map.id?this.$confirm("删除地图: ".concat(this.map.name,"?")).then(function(){return t.$http.post("/api/map/deleteMap",{id:t.map.id})}).then(function(){t.$message.success("删除成功"),location.href=location.href}).catch(console.log):this.$message.error("未选择地图!")}},{key:"onSubmit",value:function(t){var e=this;if(null==this.map.id)return this.$message.error("未选择地图!");this.$confirm("确认修改?").then(function(){return t.map?e.$http.post("/api/map/upload/mapfile",{file:t.map,mapName:t.map.name.split(".")[0]||"map"}):{resultMap:{mapUrl:t.filename||t.url}}}).then(function(a){var n=Date.now(),i=t.minX,o=t.maxX,s=t.minY,l=t.maxY;return e.$http.post({url:"/api/map/addMap",body:Object(r["a"])({},e.map,{filepath:a.resultMap.mapUrl,name:t.name,updateTime:n,updateUser:"null",margin:JSON.stringify([[i,s],[i,l],[o,l],[o,s],[t.width,t.height]])}),headers:{"Content-Type":"application/json"}})}).then(function(){e.$message.success("修改成功"),e.$refs.form.reset()}).catch(console.log)}}]),e}(h["default"]);f["a"]([Object(v["b"])()],g.prototype,"permission",void 0),g=f["a"]([Object(d["b"])({components:{"map-form":m["a"],"map-select":b["a"]}})],g);var y=g,x=y,j=a("2877"),O=Object(j["a"])(x,n,i,!1,null,null,null);e["default"]=O.exports},"38fa":function(t,e,a){t.exports={box:"Zone_box_2h2Ag"}},4078:function(t,e,a){"use strict";var n=a("8416"),i=a.n(n);e["default"]=i.a},"42de":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-select",{attrs:{filterable:"","default-first-option":"",multiple:!!t.multiple,disabled:!!t.disabled,"collapse-tags":""},on:{change:t.change},model:{value:t.currValue,callback:function(e){t.currValue=e},expression:"currValue"}},t._l(t.options,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)},i=[],r=(a("7514"),a("7f7f"),a("ac6a"),a("d225")),o=a("b0b4"),s=a("308d"),l=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("2b0e"),f=a("2fe1"),d=a("60a3"),h=function(t){function e(){var t;return Object(r["a"])(this,e),t=Object(s["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.options=[],t.currValue=null,t}return Object(c["a"])(e,t),Object(o["a"])(e,[{key:"created",value:function(){var t=this;this.$http.get(this.url,{pageSize:1e6,currentPage:1}).then(function(e){t.options=e.pagedData.datas.map(function(e){return{id:e[t.keys.id||"id"],name:e[t.keys.name],data:e}}),t.multiple?t.currValue=[]:t.currValue=null==t.value||""===t.value?t.options[0].id:t.value}).catch(console.error)}},{key:"change",value:function(t){var e=this;this.$emit("input",t),Array.isArray(t)||(t=[t]),this.$emit("change",t.map(function(t){return e.options.find(function(e){return e.id===t})}))}}]),e}(p["default"]);u["a"]([Object(d["b"])()],h.prototype,"url",void 0),u["a"]([Object(d["b"])()],h.prototype,"value",void 0),u["a"]([Object(d["b"])({default:function(){return{id:"id",name:"name"}}})],h.prototype,"keys",void 0),u["a"]([Object(d["b"])()],h.prototype,"multiple",void 0),u["a"]([Object(d["b"])()],h.prototype,"disabled",void 0),h=u["a"]([f["b"]],h);var m=h,b=m,v=a("2877"),g=Object(v["a"])(b,n,i,!1,null,null,null);e["a"]=g.exports},"456d":function(t,e,a){var n=a("4bf8"),i=a("0d58");a("5eda")("keys",function(){return function(t){return i(n(t))}})},"485c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.$style.box},[a("div",{class:t.$style["tool-bar"]},[a("map-select",{staticStyle:{"margin-left":"50px"},on:{selectmap:t.selectMap}})],1),a("div",{ref:"map",staticStyle:{height:"100%",overflow:"hidden"}}),a("history-control",{attrs:{date:t.date,path:t.path},on:{"update:date":function(e){t.date=e},"update:path":function(e){t.path=e},play:t.play,progress:t.progress,pause:t.pause,pathVisible:t.switchVisible,loaded:function(e){t.isLoaded=!0}}})],1)},i=[],r=(a("ac4d"),a("8a81"),a("ac6a"),a("9253"),a("20d6"),a("d225")),o=a("b0b4"),s=a("308d"),l=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("2fe1"),f=a("99d1"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{class:t.$style.control},[a("div",{class:t.$style.content},[a("div",{staticClass:"flex-center",class:t.$style.item,staticStyle:{"margin-right":"20px"}},[a("app-select",{staticStyle:{"min-width":"200px"},attrs:{url:"/api/tag/getall",keys:{id:"tagNo",name:"name"},multiple:!0,disabled:t.isStart},on:{change:function(e){return t.change(e,!0)}},model:{value:t.tagNos,callback:function(e){t.tagNos=e},expression:"tagNos"}}),a("el-date-picker",{staticStyle:{margin:"0 20px"},attrs:{disabled:t.isStart,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:function(e){return t.change(e,!1)}},model:{value:t.dateProxy,callback:function(e){t.dateProxy=e},expression:"dateProxy"}}),a("el-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"active-text":"显示","inactive-text":"隐藏",disabled:!t.path},on:{change:t.switchPathVisible},model:{value:t.showPath,callback:function(e){t.showPath=e},expression:"showPath"}})],1),a("div",{staticClass:"flex-center",class:t.$style.item},[a("el-button",{staticStyle:{"font-size":"24px"},attrs:{icon:t.isStart?"el-icon-video-pause":"el-icon-video-play",disabled:!t.canPlay,type:"text"},on:{click:t.play}}),a("el-button",{staticStyle:{"font-size":"24px"},attrs:{icon:"el-icon-refresh",disabled:!t.canPlay||!t.path,type:"text"},on:{click:t.rePlay}}),a("div",{staticClass:"flex-center",class:t.$style.progress},[a("span",[t._v(t._s(t._f("formatTime")(t.timeRange,t.progress)))]),a("el-slider",{staticStyle:{"flex-grow":"1",padding:"0 15px"},attrs:{disabled:!t.canPlay,"format-tooltip":t.format},on:{input:function(e){return t.$emit("progress",e)},change:function(e){return t.$emit("play",e)}},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}),a("span",[t._v(t._s(t._f("formatTime")(t.timeRange,100)))])],1)],1)])])},h=[],m=a("cebc"),b=(a("7514"),a("75fc")),v=a("2b0e"),g=a("42de"),y=a("d8c9"),x=a("60a3"),j=function(t){function e(){var t;return Object(r["a"])(this,e),t=Object(s["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.tagNos=[],t.isStart=!1,t.progress=0,t.showPath=!1,t.format=null,t}return Object(c["a"])(e,t),Object(o["a"])(e,[{key:"created",value:function(){var t=this;this.format=function(e){return Object(y["b"])(t.timeRange,e)}}},{key:"destroyed",value:function(){this._end()}},{key:"switchPathVisible",value:function(t){this.showPath=t,this.$emit("pathVisible",t)}},{key:"change",value:function(t,e){this.$emit("update:path",null),this.progress=0,this.switchPathVisible(!1),e&&(this.tags=t||void 0)}},{key:"rePlay",value:function(){this._end().play()}},{key:"play",value:function(){var t=this;this.isStart?(this._end(this.progress),this.$emit("pause")):this.path?this._play():this.tags?(this.isStart=!0,this.$http.post({url:"/api/tag/queryTagHistory",body:{startTime:this.date[0],endTime:this.date[1],tagNos:this.tagNos},headers:{"Content-Type":"application/json"}}).then(function(t){var e=t.pagedData.datas;return e.length?Promise.resolve(e):Promise.reject()}).then(this.parsePath.bind(this)).catch(function(e){t.$message.error("未查询到历史轨迹"),t.isStart=!1})):this.$message.warning("请选择标签")}},{key:"parsePath",value:function(t){var e=this,a=[],n=this.createWorker(),i=function i(){n.postMessage("loadPath",[t.splice(0,1e3),e.tags]).then(function(t){t.length?(a.push.apply(a,Object(b["a"])(t)),e.$emit("update:path",a),e.showPath&&(e.$emit("pathVisible",!1),e.$emit("pathVisible",!0)),a.length===t.length&&e._play(),i()):(e.$emit("loaded"),n.close())}).catch(console.log)};i()}},{key:"_play",value:function(){var t=this;this.timer&&(cancelAnimationFrame(this.timer),this.timer=void 0);var e=Date.now(),a=function a(){var n=Date.now();t.isStart&&(t.progress+=(n-e)/t.timeRange*100),t.progress>=100?t._end():t.timer=requestAnimationFrame(a),e=n};this.isStart=!0,a(),this.$emit("play",this.progress)}},{key:"_end",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.progress=t,this.isStart=!1,this.timer&&(cancelAnimationFrame(this.timer),this.timer=void 0),this}},{key:"createWorker",value:function(){var t=this.$worker.create([{message:"loadPath",func:function(t,e){var a={};t.forEach(function(t){var e=t.position[0],n={x:+t.position[1],y:+t.position[2],z:+t.position[3]||0,time:new Date(t.time).getTime()};n.x>=0&&n.y>=0&&n.z>=0&&(a[e]||(a[e]=[])).push(n)});var n=[];if(e){var i=function(t){if(a.hasOwnProperty){var i=a[t],r=e.find(function(e){return e.id===t});r&&n.push({id:t,position:i,icon:r.data.photo})}};for(var r in a)i(r)}return n}}]);return Object(m["a"])({},t,{close:function(){t=null}})}},{key:"dateProxy",get:function(){return this.date},set:function(t){this.$emit("update:date",t)}},{key:"canPlay",get:function(){return!!(this.tagNos.length&&this.date&&this.date.length>=2)}},{key:"timeRange",get:function(){return this.date&&this.date.length>=2?this.date[1].getTime()-this.date[0].getTime():0}}]),e}(v["default"]);u["a"]([Object(x["b"])()],j.prototype,"date",void 0),u["a"]([Object(x["b"])()],j.prototype,"path",void 0),j=u["a"]([Object(p["b"])({components:{"app-select":g["a"]},filters:{formatTime:y["b"]}})],j);var O=j,k=O,w=a("7833"),_=(a("baf6"),a("2877"));function $(t){this["$style"]=w["default"].locals||w["default"]}var S=Object(_["a"])(k,d,h,!1,$,null,null),T=S.exports,P=function(t){function e(){var t;return Object(r["a"])(this,e),t=Object(s["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.date=null,t.path=null,t.isLoaded=!1,t.index={},t.prevIndex={},t.worker=t.$worker.create(),t}return Object(c["a"])(e,t),Object(o["a"])(e,[{key:"created",value:function(){this.worker.register({message:"calcPosition",func:function(t,e,a){var n=t.findIndex(function(t){return t.time-a>=e}),i=0,r=0;if(n>-1){var o=t[n],s=t[n-1]||{x:0,y:0,z:0},l=null!=s.time?(e-s.time+t[0].time)/(o.time-s.time):1;i=(o.x-s.x)*l+s.x,r=(o.y-s.y)*l+s.y}return{x:i,y:r,i:n}}})}},{key:"destroyed",value:function(){Reflect.set(this,"worker",null)}},{key:"play",value:function(t){var e=this;if(this.isLoaded=!1,this.path&&this.mgr&&this.date&&this.date.length>=2){this.mgr.remove(),this.prevIndex={};var a=this.timeRange*t/100,n=!0,i=!1,r=void 0;try{for(var o,s=function(){var t=o.value;e.worker.postMessage("calcPosition",[t.position,a,e.date[0].getTime()]).then(function(a){var n=a.x,i=a.y,r=a.i;r>0&&e.start(n,i,r,t)}).catch(console.error)},l=this.path[Symbol.iterator]();!(n=(o=l.next()).done);n=!0)s()}catch(c){i=!0,r=c}finally{try{n||null==l.return||l.return()}finally{if(i)throw r}}}}},{key:"progress",value:function(t){var e=this;if(this.path){var a=!0,n=!1,i=void 0;try{for(var r,o=function(){var a=r.value;Promise.resolve().then(function(){if(e.mgr){var n=e.index[a.id]||0,i=a.position[n],r=a.position[n-1];if(i)if(r)e.prevIndex[a.id]!==n&&(e.mgr.moveTo(a.id,{x:i.x,y:i.y},(i.time-r.time)/1e3,void 0,function(){return e.index[a.id]++}),e.prevIndex[a.id]=n);else{if(!e.date||e.date.length<2)return;var o=e.timeRange*t/100,s=i.time-e.date[0].getTime();if(o<s)return;e.start(i.x,i.y,n,a)}else e.isLoaded&&e.mgr.remove(a.id)}})},s=this.path[Symbol.iterator]();!(a=(r=s.next()).done);a=!0)o()}catch(l){n=!0,i=l}finally{try{a||null==s.return||s.return()}finally{if(n)throw i}}}}},{key:"pause",value:function(){this.mgr&&this.mgr.stopMoveTo()}},{key:"switchVisible",value:function(t){if(this.path&&this.mgr)if(t){var e=!0,a=!1,n=void 0;try{for(var i,r=this.path[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){for(var o=i.value,s=[o.position[0]],l=1;l<o.position.length-1;l+=Math.ceil(o.position.length/300))s.push(o.position[l]);s.push(o.position[o.position.length-1]),this.mgr.addLine(s,{lineType:fengmap.FMLineType.FULL,lineWidth:2},o.id)}}catch(c){a=!0,n=c}finally{try{e||null==r.return||r.return()}finally{if(a)throw n}}}else this.mgr.removeLine()}},{key:"start",value:function(t,e,a,n){this.mgr&&(this.mgr.addImage({x:t,y:e,height:.5,url:n.icon,size:48},n.id,void 0,!1),this.index[n.id]=a+1)}},{key:"timeRange",get:function(){return!this.date||this.date.length<2?0:this.date[1].getTime()-this.date[0].getTime()}}]),e}(Object(p["c"])(f["a"]));P=u["a"]([Object(p["b"])({components:{"history-control":T}})],P);var z=P,N=z,M=a("e87d");function C(t){this["$style"]=M["default"].locals||M["default"]}var A=Object(_["a"])(N,n,i,!1,C,null,null);e["default"]=A.exports},"4f7f":function(t,e,a){"use strict";var n=a("c26b"),i=a("b39a"),r="Set";t.exports=a("e0b8")(r,function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(i(this,r),t=0===t?0:t,t)}},n)},5867:function(t,e,a){},"5eda":function(t,e,a){var n=a("5ca1"),i=a("8378"),r=a("79e5");t.exports=function(t,e){var a=(i.Object||{})[t]||Object[t],o={};o[t]=e(a),n(n.S+n.F*r(function(){a(1)}),"Object",o)}},"5eed":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"padding-left":"5%","padding-top":"3%"}},[t._m(0),a("map-form",{ref:"form",on:{submit:t.onSubmit}})],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",{staticStyle:{color:"#009688"}},[t._v("\n        地图添加\n        "),a("span",{staticStyle:{"font-size":"12px"}},[t._v('\n            (注意: 如果地图文件是fengmap文件, 需将其对应的主题文件夹放入\n            "/data/theme/" 目录)\n        ')])])}],r=(a("7f7f"),a("28a5"),a("d225")),o=a("b0b4"),s=a("308d"),l=a("6bb5"),c=a("4e2b"),u=a("9ab4"),p=a("2fe1"),f=a("2b0e"),d=a("61fd"),h=function(t){function e(){return Object(r["a"])(this,e),Object(s["a"])(this,Object(l["a"])(e).apply(this,arguments))}return Object(c["a"])(e,t),Object(o["a"])(e,[{key:"onSubmit",value:function(t){var e=this;this.$http.post("/api/map/upload/mapfile",{file:t.map,mapName:t.map.name.split(".")[0]||"map"}).then(function(a){var n=Date.now(),i=t.minX,r=t.maxX,o=t.minY,s=t.maxY;return e.$http.post({url:"/api/map/addMap",body:{createTime:n,createUser:"null",filepath:a.resultMap.mapUrl,name:t.name,updateTime:n,updateUser:"null",margin:JSON.stringify([[i,o],[i,s],[r,s],[r,o],[t.width,t.height]])},headers:{"Content-Type":"application/json"}})}).then(function(){e.$message.success("添加成功"),e.$refs.form.reset()}).catch(console.log)}}]),e}(f["default"]);h=u["a"]([Object(p["b"])({components:{"map-form":d["a"]}})],h);var m=h,b=m,v=a("2877"),g=Object(v["a"])(b,n,i,!1,null,null,null);e["default"]=g.exports},"60f5":function(t,e,a){t.exports={box:"Census_box_3bEXU"}},"61fd":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form",attrs:{"label-width":"auto",model:t.form}},[a("el-form-item",{attrs:{label:"地图名称",prop:"name",required:""}},[a("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入地图名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._l(["minX","maxX","minY","maxY"],function(e){return a("el-form-item",{key:e,attrs:{label:e,prop:e,required:""}},[a("el-input-number",{attrs:{step:100,placeholder:"地图坐标"},model:{value:t.form[e],callback:function(a){t.$set(t.form,e,a)},expression:"form[k]"}})],1)}),a("el-form-item",{attrs:{label:"地图大小",required:""}},[a("el-form-item",{class:t.$style.inline,attrs:{required:"",prop:"width"}},[a("el-input-number",{attrs:{step:100,placeholder:"宽(实际)"},model:{value:t.form.width,callback:function(e){t.$set(t.form,"width",e)},expression:"form.width"}})],1),a("el-form-item",{class:t.$style.inline,staticStyle:{"margin-left":"20px"},attrs:{required:"",prop:"height"}},[a("el-input-number",{attrs:{step:100,placeholder:"高(实际)"},model:{value:t.form.height,callback:function(e){t.$set(t.form,"height",e)},expression:"form.height"}})],1)],1),a("el-form-item",{attrs:{required:"",label:"地图"}},[a("el-upload",{attrs:{"auto-upload":!1,action:"","show-file-list":!1,"on-change":t.changeUpload}},[a("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-upload"}},[t._v("\n                选择文件\n            ")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t.form.url?a("img",{class:t.$style.img,attrs:{src:t.form.url}}):[t._v("\n                    "+t._s(t.form.filename||"只能上传jpg/png/fmp文件，且不超过5M")+"\n                ")]],2)],1)],1),a("el-form-item",[a("el-button",{attrs:{type:"success"},on:{click:t.submit}},[t._v("立即提交")])],1)],2)},i=[],r=a("cebc"),o=(a("7f7f"),a("aef6"),a("d225")),s=a("b0b4"),l=a("308d"),c=a("6bb5"),u=a("4e2b"),p=a("9ab4"),f=a("2b0e"),d=a("2fe1"),h=a("60a3"),m=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(l["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.form={url:"",filename:"",map:null,name:""},t.changeUpload=null,t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){var t=this;this.changeUpload=function(e){if("image/png"!==e.raw.type&&"image/jpeg"!==e.raw.type&&!e.name.endsWith(".fmap"))return t.$message.error("只能上传jpg/png/fmag文件!");if(e.size/1024/1024>5)return t.$message.error("上传文件大小不能超过 5MB!");if(e.name.endsWith(".fmap"))t.form.url="",t.form.filename=e.name;else{var a=new FileReader;a.onload=function(e){t.form.filename="",t.form.url=e.target.result},a.readAsDataURL(e.raw)}t.form.map=e.raw}}},{key:"submit",value:function(){var t=this,e=this.$refs.form;e.validate().then(function(){if(!(t.form.map||t.form.url||t.form.filename))return t.$message.warning("地图文件不能为空");var e=Object(r["a"])({},t.form);t.$emit("update:data",e),t.$emit("submit",e)}).catch(console.log)}},{key:"reset",value:function(){return this.$refs.form.resetFields(),this.form.map=null,this.form.url=this.form.filename="",{}}},{key:"assignForm",value:function(){Object.assign(this.form,this.data)}}]),e}(f["default"]);p["a"]([Object(h["b"])({default:function(){return{}}})],m.prototype,"data",void 0),p["a"]([Object(h["a"])("update:data")],m.prototype,"reset",null),p["a"]([Object(h["c"])("data")],m.prototype,"assignForm",null),m=p["a"]([d["b"]],m);var b=m,v=b,g=a("4078"),y=a("2877");function x(t){this["$style"]=g["default"].locals||g["default"]}var j=Object(y["a"])(v,n,i,!1,x,null,null);e["a"]=j.exports},7833:function(t,e,a){"use strict";var n=a("d8d1"),i=a.n(n);e["default"]=i.a},8416:function(t,e,a){t.exports={img:"MapEdit_img_1sgW2",inline:"MapEdit_inline_2M2U8"}},8615:function(t,e,a){var n=a("5ca1"),i=a("504c")(!1);n(n.S,"Object",{values:function(t){return i(t)}})},"89b9":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.$style.box,on:{click:t.hiddenCover}},[a("div",{staticClass:"flex-center",class:t.$style["tool-bar"]},[a("map-select",{on:{selectmap:t.selectMap}}),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入标签号",type:"search"},model:{value:t.findTarget,callback:function(e){t.findTarget=e},expression:"findTarget"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.find},slot:"append"})],1)],1),a("div",{ref:"map",staticStyle:{height:"100%",overflow:"hidden"}}),a("div",{class:t.$style.tools},t._l(t.tools,function(e,n){return a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"v.display"}],key:n,class:t.$style["tool-item"],attrs:{type:e.active?"primary":""},on:{click:function(e){return e.stopPropagation(),t.swithDisplay(n)}}},[t._v("\n            "+t._s(e.name)+"\n        ")])}),1),a("transition",{attrs:{name:"el-zoom-in-bottom"}},[t.tools[4].active?a("Census",{attrs:{tags:t.tagAll,zones:t.zoneAll,renderTags:t.renderTags},on:{close:function(e){t.tools[4].active=!1}}}):t._e()],1),a("transition",{attrs:{name:"el-fade-in-linear"}},[t.tools[3].active?a("Group",{attrs:{group:t.group}}):t._e(),t.tools[2].active?a("Zone",{attrs:{zones:t.zoneAll}}):t._e()],1)],1)},i=[],r=a("cebc"),o=(a("456d"),a("4917"),a("7f7f"),a("75fc")),s=a("768b"),l=(a("ac4d"),a("8a81"),a("8615"),a("96cf"),a("3b8d")),c=(a("ac6a"),a("5df3"),a("f400"),a("d225")),u=a("b0b4"),p=a("308d"),f=a("6bb5"),d=a("4e2b"),h=a("9ab4"),m=a("2fe1"),b=a("99d1"),v=a("d8c9"),g=a("b3af"),y=a("ae85"),x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{on:{click:function(t){t.stopPropagation()}}},[a("el-card",{ref:"table",staticClass:"card",class:t.$style.box},[a("app-table",{attrs:{"max-height":500,"table-data":t.tableData,"col-cfg":t.colCfg,"total-count":t.totalCount,op:[{type:"danger",name:"switch",desc:"切换显示"}],isSmall:!0,noPrint:!0},on:{switch:t.switchZone,updateData:t.getData}})],1)],1)},j=[],O=(a("d185"),a("4f7f"),a("60a3")),k=new Set,w=function(t){function e(){var t;return Object(c["a"])(this,e),t=Object(p["a"])(this,Object(f["a"])(e).apply(this,arguments)),t.colCfg=[{prop:"name",label:"区域"},{prop:"status",label:"状态"}],t}return Object(d["a"])(e,t),Object(u["a"])(e,[{key:"switchZone",value:function(t){if(this.$parent){var e=Reflect.get(this.$parent,"mgr");e&&(k.has(t.name)?(e.remove(t.name),k.delete(t.name)):(e.zoneOpen(t),k.add(t.name)))}}},{key:"fetch",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(e,a){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=this.zones.slice((e-1)*a,e*a),t.abrupt("return",{count:this.zones.length,data:n.map(function(t){var e=Object(r["a"])({},t);return e.status=t.enable?"开启":"关闭",e.position="string"===typeof t.position?JSON.parse(t.position):t.position,e})});case 2:case"end":return t.stop()}},t,this)}));function e(e,a){return t.apply(this,arguments)}return e}()}]),e}(Object(m["c"])(y["a"]));h["a"]([Object(O["b"])()],w.prototype,"zones",void 0),w=h["a"]([m["b"]],w);var _=w,$=_,S=a("fcc3"),T=a("2877");function P(t){this["$style"]=S["default"].locals||S["default"]}var z=Object(T["a"])($,x,j,!1,P,null,null),N=z.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{on:{click:function(t){t.stopPropagation()}}},[a("el-card",{ref:"table",staticClass:"card",class:t.$style.box},[a("app-table",{attrs:{"max-height":500,"table-data":t.tableData,"col-cfg":t.colCfg,"total-count":t.totalCount,op:[{type:"danger",name:"switch",desc:"切换显示"}],isSmall:!0,noPrint:!0},on:{switch:t.switchZone,updateData:t.getData}})],1)],1)},C=[],A=(a("ffc1"),function(t){function e(){var t;return Object(c["a"])(this,e),t=Object(p["a"])(this,Object(f["a"])(e).apply(this,arguments)),t.colCfg=[{prop:"id",label:"分组"}],t}return Object(d["a"])(e,t),Object(u["a"])(e,[{key:"switchZone",value:function(t){if(this.$parent){var e=Reflect.get(this.$parent,"mgr");e&&t.children.forEach(function(t){return e.show(t.baseNo)})}}},{key:"fetch",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(e,a){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return n=Object.entries(this.group).slice((e-1)*a,e*a),t.abrupt("return",{count:n.length,data:n.map(function(t){return{id:t[0],children:t[1]}})});case 2:case"end":return t.stop()}},t,this)}));function e(e,a){return t.apply(this,arguments)}return e}()}]),e}(Object(m["c"])(y["a"])));h["a"]([Object(O["b"])()],A.prototype,"group",void 0),A=h["a"]([m["b"]],A);var D=A,R=D,E=a("932b");function U(t){this["$style"]=E["default"].locals||E["default"]}var V=Object(T["a"])(R,M,C,!1,U,null,null),I=V.exports,W=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{on:{click:function(t){t.stopPropagation()}}},[a("el-card",{class:t.$style.box},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("标签统计")]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",icon:"el-icon-close"},on:{click:function(e){return t.$emit("close")}}})],1),a("el-form",{staticStyle:{margin:"0 auto 44px"}},[a("el-form-item",{attrs:{label:"选择区域"}},[a("el-select",{attrs:{filterable:""},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[a("el-option",{attrs:{label:"当前地图",value:-1}}),t._l(t.zones,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})],2)],1)],1),t.info?a("div",{staticStyle:{"border-bottom":"1px solid #ccc","text-align":"center"}},[t._v("\n            "+t._s(t.info.name)+"标签数量: "+t._s(t.info.count)+"\n        ")]):t._e()],1)],1)},F=[],L=(a("aef6"),a("7514"),a("2b0e")),X=function(t){function e(){var t;return Object(c["a"])(this,e),t=Object(p["a"])(this,Object(f["a"])(e).apply(this,arguments)),t.value=-1,t}return Object(d["a"])(e,t),Object(u["a"])(e,[{key:"info",get:function(){var t=this;if(this.tags&&this.zones&&this.renderTags){var e=Object.keys(this.renderTags);if(-1===this.value)return{name:"当前地图",count:e.length};var a=this.zones.find(function(e){return e.id===t.value});if(a){var n=e.filter(function(e){return+t.tags[e].zone===t.value});return{name:a.name+(a.name.endsWith("区域")?"":"区域"),count:n.length}}}return null}}]),e}(L["default"]);h["a"]([Object(O["b"])()],X.prototype,"tags",void 0),h["a"]([Object(O["b"])()],X.prototype,"zones",void 0),h["a"]([Object(O["b"])()],X.prototype,"renderTags",void 0),X=h["a"]([m["b"]],X);var q=X,Y=q,H=a("1896");function J(t){this["$style"]=H["default"].locals||H["default"]}var Z=Object(T["a"])(Y,W,F,!1,J,null,null),G=Z.exports,B=a("0d1f"),K=function(t){function e(){var t;return Object(c["a"])(this,e),t=Object(p["a"])(this,Object(f["a"])(e).apply(this,arguments)),t.group={},t.tools=[{name:"2D",active:!0,display:!0},{name:"3D",active:!1,display:!1},{name:"区域列表",active:!1,display:!0},{name:"分组列表",active:!1,display:!0},{name:"统计",active:!1,display:!0}],t.zoneAll=[],t.findTarget="",t.baseAll=[],t.tagAll={},t.ws=[],t.renderTags={},t.pops=new Map,t}return Object(d["a"])(e,t),Object(u["a"])(e,[{key:"created",value:function(){var t=this;Promise.all(["tag","zone"].map(function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(a){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$http.get("/api/".concat(a,"/getall"),{currentPage:1,pageSize:1e8});case 3:return n=e.sent,e.abrupt("return",n.pagedData.datas);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",[]);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}())).then(function(e){t.zoneAll=e[1],t.tagAll=Object(v["a"])(e[0],"tagNo",!1)})}},{key:"beforeDestroy",value:function(){var t=this.ws.pop();while(t)t.close(),t.onmessage=null,t=this.ws.pop();Object.values(this.renderTags).forEach(clearTimeout)}},{key:"swithDisplay",value:function(t){var e=this.tools[t];if(t<2){if(e.active)return;var a=this.tools[t?0:1];a.active=!a.active,this.mgr&&this.mgr.switchViewMode()}if(e.active=!e.active,2===t||3===t){var n=this.tools[2===t?3:2];e.active&&(n.active=!1)}}},{key:"hiddenCover",value:function(){for(var t=2;t<this.tools.length;t++)this.tools[t].active=!1}},{key:"find",value:function(){if(!this.findTarget)return this.$message.warning("请输入标签号");if(this.mgr&&!this.pops.has(this.findTarget)){var t=this.mgr.findSprite(this.findTarget);t?this.pops.set(this.findTarget,this.mgr.addPopInfo(t)):this.$message.info("未找到标签号为".concat(this.findTarget,"的标签"))}this.findTarget=""}},{key:"bindEvents",value:function(){var t=this;this.mgr.on("loadComplete",function(){t.mgr&&(t.tools[1].display=t.mgr.has3D,t.tagAnchor().then(function(e){t.baseAll=e,t.group=Object(v["a"])(e,"groupCode"),t.initWebSoket()}))}),this.mgr.on("mapClickNode",function(e){if(t.mgr)if(e.nodeType===fengmap.FMNodeType.IMAGE_MARKER&&e.target.custom&&e.target.custom.info.tagNo){var a=e.target.custom.info.tagNo;t.pops.has(a)||t.pops.set(a,t.mgr.addPopInfo(e.target))}else{var n=!0,i=!1,r=void 0;try{for(var o,l=t.pops.entries()[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var c=Object(s["a"])(o.value,2),u=c[0],p=c[1];p.close()&&t.pops.delete(u)}}catch(f){i=!0,r=f}finally{try{n||null==l.return||l.return()}finally{if(i)throw r}}}})}},{key:"tagAnchor",value:function(){var t=Object(l["a"])(regeneratorRuntime.mark(function t(){var e,a,n,i,r,s,l,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e=Object(o["a"])(this.baseAll),e.length){t.next=7;break}return t.next=5,this.$http.get("/api/base/getall",{currentPage:1,pageSize:1e4});case 5:a=t.sent,e=a.pagedData.datas;case 7:if(!this.mgr){t.next=27;break}for(n=!0,i=!1,r=void 0,t.prev=11,s=e[Symbol.iterator]();!(n=(l=s.next()).done);n=!0)c=l.value,this.addIcon(1,{x:c.coordx,y:c.coordy,name:c.baseNo,groupid:c.groupCode,photo:"/images/anchor.png",size:32},2),this.mgr.addTextMarker({height:2,fillcolor:"#009688",fontsize:15,type:1,strokecolor:"255,255,0",x:c.coordx,y:c.coordy-40},c.baseNo+"");t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](11),i=!0,r=t.t0;case 19:t.prev=19,t.prev=20,n||null==s.return||s.return();case 22:if(t.prev=22,!i){t.next=25;break}throw r;case 25:return t.finish(22);case 26:return t.finish(19);case 27:return t.abrupt("return",e);case 30:return t.prev=30,t.t1=t["catch"](0),t.abrupt("return",[]);case 33:case"end":return t.stop()}},t,this,[[0,30],[11,15,19,27],[20,,22,26]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"addIcon",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.mgr){var n=this.mgr.map;return this.mgr instanceof B["a"]&&(n.gestureEnableController.enableMapHover=!0),this.mgr.addImage({x:e.x,y:e.y,height:.5,url:e.photo,size:e.size||48,callback:function(t){t.custom||(t.custom={}),Object.assign(t.custom,{type:a,info:e}),e.callback&&e.callback(t)}},e.name,t,!!e.isMapCoor)}}},{key:"initWebSoket",value:function(){var t=this,e=Date.now(),a=location.host;this.ws=Object.keys(this.group).map(function(n){var i=new WebSocket("ws://".concat(a,":80/realtime/position/").concat(n,"/").concat(e));return i.onmessage=function(e){var a=JSON.parse(e.data);t.tagAll[a.sTagNo]&&t.move(a)},i})}},{key:"move",value:function(t){var e=this;if(!this.mgr)return console.log("获取地图失败!!");if(t.position.every(function(t){return+t>=0})){var a=this.renderTags[t.sTagNo],n={x:+t.position[0],y:+t.position[1]};if(a)clearTimeout(a),this.mgr.show(t.sTagNo,!0),this.mgr.moveTo(t.sTagNo,n,1,function(){var a=e.pops.get(t.sTagNo);a&&a.update&&a.update()});else{var i=Object(r["a"])({},this.tagAll[t.sTagNo],{name:t.sTagNo,tagName:this.tagAll[t.sTagNo].name},n,{callback:function(t){t.alwaysShow&&t.alwaysShow()}}),o=this.mgr.map.groupIDs;this.addIcon(o?o[0]:0,i)}this.renderTags[t.sTagNo]=setTimeout(function(){e.$notify.warning("标签".concat(t.sTagNo,"异常。\n信号丢失!")),e.mgr&&e.mgr.show(t.sTagNo,!1)},g["e"])}}}]),e}(Object(m["c"])(b["a"],y["a"]));K=h["a"]([Object(m["b"])({components:{Zone:N,Group:I,Census:G}})],K);var Q=K,tt=Q,et=a("0a43");function at(t){this["$style"]=et["default"].locals||et["default"]}var nt=Object(T["a"])(tt,n,i,!1,at,null,null);e["default"]=nt.exports},"932b":function(t,e,a){"use strict";var n=a("b5c5"),i=a.n(n);e["default"]=i.a},"957f":function(t,e,a){t.exports={box:"Monitor_box_3P_5U","tool-bar":"Monitor_tool-bar_2GPUR",tools:"Monitor_tools_iFLWy","tool-item":"Monitor_tool-item_182Qz"}},a89f:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"main"},[a("div",{staticStyle:{"overflow-y":"auto"},style:{height:t.mainHeight}},[a("router-view")],1)]),a("app-aside",{attrs:{tabs:t.tabs}})],1)},i=[],r=a("d225"),o=a("308d"),s=a("6bb5"),l=a("4e2b"),c=a("9ab4"),u=a("2fe1"),p=a("3d13"),f=a("cda1"),d=a("2b0e"),h=function(t){function e(){var t;return Object(r["a"])(this,e),t=Object(o["a"])(this,Object(s["a"])(e).apply(this,arguments)),t.tabs=[{title:"实时监控",to:"/monitor",icon:"el-icon-view"},{title:"历史轨迹",to:"/monitor/history",icon:"el-icon-film"},{title:"地图编辑",to:"/monitor/edit",icon:"el-icon-edit"},{title:"地图添加",to:"/monitor/add",icon:"el-icon-document-add"}],t}return Object(l["a"])(e,t),e}(d["default"]);c["a"]([Object(f["a"])("mainHeight")],h.prototype,"mainHeight",void 0),h=c["a"]([Object(u["b"])({components:{"app-aside":p["a"]}})],h);var m=h,b=m,v=a("2877"),g=Object(v["a"])(b,n,i,!1,null,null,null);e["default"]=g.exports},aef6:function(t,e,a){"use strict";var n=a("5ca1"),i=a("9def"),r=a("d2c8"),o="endsWith",s=""[o];n(n.P+n.F*a("5147")(o),"String",{endsWith:function(t){var e=r(this,t,o),a=arguments.length>1?arguments[1]:void 0,n=i(e.length),l=void 0===a?n:Math.min(i(a),n),c=String(t);return s?s.call(e,c,l):e.slice(l-c.length,l)===c}})},b5c5:function(t,e,a){t.exports={box:"Group_box_MIaUk"}},baf6:function(t,e,a){"use strict";var n=a("5867"),i=a.n(n);i.a},c7e9:function(t,e,a){t.exports={box:"History_box_28f2B","tool-bar":"History_tool-bar_3iu_9"}},d8d1:function(t,e,a){t.exports={control:"Control_control_-Xm__",content:"Control_content_8jrU1",progress:"Control_progress_3Owql",item:"Control_item_3l-J0"}},e87d:function(t,e,a){"use strict";var n=a("c7e9"),i=a.n(n);e["default"]=i.a},fcc3:function(t,e,a){"use strict";var n=a("38fa"),i=a.n(n);e["default"]=i.a}}]);
//# sourceMappingURL=map.4ecd7102.js.map