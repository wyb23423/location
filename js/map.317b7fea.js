(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["map"],{"066f":function(t,e,n){t.exports={img:"MapEdit_img_4UK2I",inline:"MapEdit_inline_1gt2L"}},"09a4":function(t,e,n){t.exports={mark:"History_mark_3NHky"}},"0a43":function(t,e,n){"use strict";var a=n("0ebb"),r=n.n(a);e["default"]=r.a},"0ebb":function(t,e,n){t.exports={"tool-bar":"Monitor_tool-bar_2GPUR",tools:"Monitor_tools_iFLWy","tool-item":"Monitor_tool-item_182Qz",switch:"Monitor_switch_3ZIU_"}},1250:function(t,e,n){t.exports={box:"Census_box_3bEXU"}},1637:function(t,e,n){t.exports={box:"Zone_box_2h2Ag"}},1896:function(t,e,n){"use strict";var a=n("1250"),r=n.n(a);e["default"]=r.a},"20d6":function(t,e,n){"use strict";var a=n("5ca1"),r=n("0a49")(6),i="findIndex",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),a(a.P+a.F*o,"Array",{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(i)},"2a87":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"padding-left":"5%","padding-top":"3%"}},[n("h3",{staticStyle:{color:"#009688"}},[t._v("\n        地图编辑\n    ")]),n("el-form",{attrs:{inline:""}},[n("el-form-item",{attrs:{label:"选择地图"}},[n("map-select",{on:{selectmap:t.selectMap}})],1),n("el-form-item",[t.permission.delete?n("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:t.del}},[t._v("\n                删除\n            ")]):t._e()],1)],1),n("div",{staticClass:"el-divider el-divider--horizontal",staticStyle:{width:"95%","background-color":"#e00"}}),t.permission.put?n("map-form",{attrs:{data:t.map},on:{submit:t.onSubmit,"update:data":function(e){t.map=e}}}):t._e()],1)},r=[],i=(n("28a5"),n("bd86")),o=(n("aef6"),n("7f7f"),n("d225")),s=n("b0b4"),c=n("308d"),l=n("6bb5"),u=n("4e2b"),p=n("9ab4"),f=n("2fe1"),h=n("2b0e"),d=n("da56"),m=n("20e4"),g=n("60a3"),b=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.map={},t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"selectMap",value:function(t){var e=t.margin;this.map=Object(i["a"])({id:t.id,name:t.name,minX:e[0][0],maxX:e[2][0],minY:e[0][1],maxY:e[2][1],width:e[4][0],height:e[4][1]},t.filepath.endsWith(".fmap")?"filename":"url",t.filepath)}},{key:"del",value:function(){var t=this;null!=this.map.id?this.$confirm("删除地图: ".concat(this.map.name,"?")).then((function(){return t.$http.post("/api/map/deleteMap",{id:t.map.id})})).then((function(){t.$message.success("删除成功"),location.href=location.href})).catch(console.log):this.$message.error("未选择地图!")}},{key:"onSubmit",value:function(t){var e=this;if(null==this.map.id)return this.$message.error("未选择地图!");this.$confirm("确认修改?").then((function(){return t.map?e.$http.post("/api/map/upload/mapfile",{file:t.map,mapName:t.map.name.split(".")[0]||"map"}):{resultMap:{mapUrl:t.filename||t.url}}})).then((function(n){var a=t.minX,r=t.maxX,i=t.minY,o=t.maxY;return e.$http.post({url:"/api/map/updateMap",body:{id:e.map.id,filepath:n.resultMap.mapUrl,name:t.name,groupCode:JSON.stringify(t.groupCode),margin:JSON.stringify([[a,i],[a,o],[r,o],[r,i],[t.width,t.height]])},headers:{"Content-Type":"application/json"}})})).then((function(){return e.$message.success("修改成功")})).catch(console.log)}}]),e}(h["default"]);Object(p["a"])([Object(g["d"])()],b.prototype,"permission",void 0),b=Object(p["a"])([Object(f["b"])({components:{"map-form":d["a"],"map-select":m["a"]}})],b);var v=b,y=v,O=n("2877"),j=Object(O["a"])(y,a,r,!1,null,null,null);e["default"]=j.exports},"485c":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map-box"},[n("div",{staticClass:"map-tool-bar flex-center",staticStyle:{"justify-content":"flex-start"}},[n("map-select",{staticStyle:{"margin-left":"50px"},on:{selectmap:t.selectMap}})],1),n("div",{ref:"map",staticStyle:{height:"100%",overflow:"hidden"}}),n("history-control",{ref:"control",attrs:{date:t.date,showPath:t.showPath,timeRange:t.timeRange,loadCall:t.loadCall},on:{"update:date":function(e){t.date=e},"update:showPath":function(e){t.showPath=e},"update:show-path":function(e){t.showPath=e},play:t.onPlay,progress:t.onProgress,pause:t.onPause,"set-icons":t.setIcons},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}),t.isLoading?n("div",{staticClass:"flex-center",class:t.$style.mark},[n("i",{staticClass:"el-icon-loading"})]):t._e()],1)},r=[],i=(n("6762"),n("2fdb"),n("768b")),o=(n("ffc1"),n("96cf"),n("3b8d")),s=(n("f400"),n("ac6a"),n("5df3"),n("4f7f"),n("d225")),c=n("b0b4"),l=n("308d"),u=n("6bb5"),p=n("4e2b"),f=n("9ab4"),h=n("2fe1"),d=n("b3c9"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-card",{class:t.$style.control},[n("div",{class:t.$style.content},[n("div",{staticClass:"flex-center",class:t.$style.item,staticStyle:{"margin-right":"20px"}},[n("el-select",{staticStyle:{"min-width":"200px"},attrs:{disabled:t.isPlaying,"multiple-limit":5,loading:t.loading,"remote-method":t.remoteMethod,placeholder:"请输入标签名",multiple:"",remote:"",filterable:"","collapse-tags":""},on:{change:t.change},model:{value:t.tagNos,callback:function(e){t.tagNos=e},expression:"tagNos"}},t._l(t.options,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),n("el-date-picker",{staticStyle:{margin:"0 20px"},attrs:{disabled:t.isPlaying,type:"datetimerange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:t.change},model:{value:t.dateProxy,callback:function(e){t.dateProxy=e},expression:"dateProxy"}}),n("el-switch",{staticStyle:{"flex-shrink":"0"},attrs:{"active-text":"显示","inactive-text":"隐藏",disabled:!t.hasData},model:{value:t.showPathProxy,callback:function(e){t.showPathProxy=e},expression:"showPathProxy"}})],1),n("div",{staticClass:"flex-center",class:t.$style.item},[n("el-button",{staticStyle:{"font-size":"24px"},attrs:{icon:t.isPlaying?"el-icon-video-pause":"el-icon-video-play",disabled:!t.canPlay,type:"text"},on:{click:t.play}}),n("el-button",{staticStyle:{"font-size":"24px"},attrs:{disabled:!t.hasData,icon:"el-icon-refresh",type:"text"},on:{click:t.rePlay}}),n("div",{staticClass:"flex-center",class:t.$style.progress},[n("span",[t._v(t._s(t._f("formatTime")(t.timeRange,t.progress)))]),n("el-slider",{staticStyle:{"flex-grow":"1",padding:"0 15px"},attrs:{disabled:!t.canPlay,"format-tooltip":t.format},on:{input:function(e){return t.$emit("progress")},change:function(e){return t.$emit("play")}},model:{value:t.progress,callback:function(e){t.progress=e},expression:"progress"}}),n("span",[t._v(t._s(t._f("formatTime")(t.timeRange,100)))])],1)],1)])])},g=[],b=(n("7f7f"),n("dc0f")),v=n("2b0e"),y=n("60a3"),O=n("3c38"),j=12e5,w=function(t){function e(){var t;return Object(s["a"])(this,e),t=Object(l["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.tagNos=[],t.hasData=!1,t.fragmentLength=j,t}return Object(p["a"])(e,t),Object(c["a"])(e,[{key:"destroyed",value:function(){this.controller&&this.controller.abort()}},{key:"loadData",value:function(){var t=this;if(!this.timeRange)return Promise.reject("时间范围错误");if(this.timeRange>108e5)return Promise.reject("选择的时间范围不得超过3小时");this.controller&&this.controller.abort();var e=this.index;e||(this.fragmentLength=j);var n=this.date[0]+e*this.fragmentLength,a=Math.min(n+this.fragmentLength,this.date[1]);return this.fetch(n,a).then((function(t){return e?t:O["a"].clear().then((function(){return t}))})).then((function(n){return e||(t.fragmentLength=1e4*j/(n.length||1e4)),t.hasData=!0,t.syncLoad(a,e).savePosition(e,n)}))}},{key:"syncLoad",value:function(t,e){var n=this;if(!(this.date&&null!=this.date[1]&&t<this.date[1]))return this;this.controller=new AbortController;for(var a=[],r=function(r){if(a.push(n.fetch(t,Math.min(t+n.fragmentLength,n.date[1]),n.controller).then((function(t){n.savePosition(e+r,t),n.loadCall&&n.loadCall(n,e+r)}))),t+=n.fragmentLength,t>=n.date[1])return"break"},i=1;i<=6;i++){var o=r(i);if("break"===o)break}return Promise.all(a).then((function(){return n.syncLoad(t,e+6)})).catch(console.log),this}},{key:"fetch",value:function(t,e,n){var a=6e4*(new Date).getTimezoneOffset();return this.$http.post({url:"/api/tag/queryTagHistory",body:{startTime:new Date(t-a),endTime:new Date(e-a),tagNos:this.tagNos},headers:{"Content-Type":"application/json"},controller:n}).then((function(t){var e=t.pagedData.datas;return Promise.resolve(e)}))}},{key:"savePosition",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,O["a"].getItem(e+"");case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t["catch"](0),a={},r=6e4*(new Date).getTimezoneOffset(),n.forEach((function(t){t.position.every((function(t){return+t>=0}))&&(a[t.sTagNo]||(a[t.sTagNo]=[])).push({x:+t.position[1],y:+t.position[2],z:+t.position[3]||0,time:new Date(t.time).getTime()+r,group:t.sGroupNo})})),t.abrupt("return",O["a"].setItem(e+"",a));case 12:case"end":return t.stop()}}),t,null,[[0,6]])})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"dateProxy",get:function(){return this.date||null},set:function(t){this.$emit("update:date",t)}},{key:"progress",get:function(){return this.value||0},set:function(t){this.$emit("input",t)}},{key:"canPlay",get:function(){return!!(this.tagNos.length&&this.date&&this.date.length>=2)}},{key:"index",get:function(){var t=this.progress*this.timeRange/100-j;return t<=0?0:Math.ceil(t/this.fragmentLength)}},{key:"count",get:function(){if(!this.timeRange)return 0;var t=Math.max(0,this.timeRange-j);return Math.ceil(t/this.fragmentLength)+1}}]),e}(v["default"]);Object(f["a"])([Object(y["d"])()],w.prototype,"date",void 0),Object(f["a"])([Object(y["d"])()],w.prototype,"timeRange",void 0),Object(f["a"])([Object(y["d"])()],w.prototype,"value",void 0),Object(f["a"])([Object(y["d"])()],w.prototype,"loadCall",void 0),w=Object(f["a"])([h["b"]],w);var x=w,k=function(t){function e(){var t;return Object(s["a"])(this,e),t=Object(l["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.loading=!1,t.remoteMethod=null,t.format=null,t.isPlaying=!1,t.options=[],t}return Object(p["a"])(e,t),Object(c["a"])(e,[{key:"created",value:function(){var t=this;this.format=function(e){return Object(b["b"])(t.timeRange,e)};var e=0;this.remoteMethod=function(n){if(!t.loading){if(clearTimeout(e),!n)return t.options.length=0;e=setTimeout((function(){t.loading=!0,t.$http.get("/api/tag/getall",{pageSize:100,currentPage:1,name:n}).then((function(e){t.options.length=0;var n=new Map;e.pagedData.datas.forEach((function(e){t.options.push({label:e.name,value:e.tagNo}),n.set(e.tagNo,e.photo)})),t.$emit("set-icons",n),t.loading=!1})).catch(console.log)}),500)}}}},{key:"destroyed",value:function(){this.pause()}},{key:"change",value:function(){this.hasData=this.showPathProxy=!1,this.progress=0}},{key:"rePlay",value:function(){this.pause(),Promise.resolve().then(this.play.bind(this))}},{key:"play",value:function(){var t=this;this.isPlaying?this.pause(this.progress).$emit("pause"):this.hasData?(this.isPlaying=!0,this._play()):this.tagNos.length?(this.isPlaying=!0,this.loadData().then(this._play.bind(this)).catch((function(e){e&&t.$message.error(e),t.isPlaying=!1}))):this.$message.warning("请选择标签")}},{key:"pause",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.timer&&(cancelAnimationFrame(this.timer),this.timer=void 0),this.progress=t,this.isPlaying=!1,this}},{key:"_play",value:function(){var t=this;this.timer&&(cancelAnimationFrame(this.timer),this.timer=void 0);var e=Date.now(),n=function n(){var a=Date.now();t.isPlaying&&(t.progress+=(a-e)/t.timeRange*100),t.progress>=100?t.pause():t.timer=requestAnimationFrame(n),e=a};n(),this.$emit("play")}},{key:"showPathProxy",get:function(){return this.showPath},set:function(t){this.$emit("update:showPath",t)}}]),e}(Object(h["c"])(x));Object(f["a"])([Object(y["d"])()],k.prototype,"showPath",void 0),k=Object(f["a"])([Object(h["b"])({filters:{formatTime:b["b"]}})],k);var _=k,P=_,$=n("7833"),C=(n("baf6"),n("2877"));function S(t){this["$style"]=$["default"].locals||$["default"]}var D=Object(C["a"])(P,m,g,!1,S,null,null),T=D.exports,M=function(t){function e(){var t;return Object(s["a"])(this,e),t=Object(l["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.date=null,t.progress=0,t.loadCall=null,t.isLoading=!1,t.renderTags=new Set,t.next={},t.moving=new Set,t.fragmentIndex=-1,t.points={},t.icons=new Map,t}return Object(p["a"])(e,t),Object(c["a"])(e,[{key:"created",value:function(){var t=this;this.loadCall=function(e,n){n===t.fragmentIndex&&t.isLoading&&(t.isLoading=!1,e.play())}}},{key:"setIcons",value:function(t){var e=this;t.forEach((function(t,n){return e.icons.set(n,t)}))}},{key:"onPlay",value:function(){var t=this;this.mgr&&this.date&&this.date.length>=2&&this.getFragment().then((function(){t.mgr&&t.mgr.remove(),setTimeout((function(){t.next={},t.moving.clear(),t.renderTags.clear()}),100)})).catch(console.log)}},{key:"onProgress",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,n,a,r,o,s,c=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(this.fragmentIndex<0)){t.next=2;break}return t.abrupt("return");case 2:return e=this.fragmentIndex,n=this.points,t.prev=4,t.next=7,this.getFragment();case 7:t.next=12;break;case 9:return t.prev=9,t.t0=t["catch"](4),t.abrupt("return",console.log(t.t0));case 12:a=function(){var t=Object(i["a"])(o[r],2),a=t[0],s=t[1];if(c.moving.has(a))return"continue";Promise.resolve().then((function(){return c.mgr?c.parseProgress(s,e,n[a]||[],a):Promise.reject("地图不存在")})).then((function(t){var e=t.prev,n=t.target,r=t.record;if(!c.groups.includes(n.group))return c.mgr&&(c.mgr.remove(a),c.mgr.lineMgr.remove(a)),c.renderTags.delete(a);if(e&&c.renderTags.has(a)){var i=n.time-e.time+r.errorTime;c.moveTo(a,n,i).then((function(){return c.moving.delete(a)})),c.moving.add(a),r.index++,c.next[a]=r}else c.start(n,a)})).catch(console.log)},r=0,o=Object.entries(this.points);case 14:if(!(r<o.length)){t.next=21;break}if(s=a(),"continue"!==s){t.next=18;break}return t.abrupt("continue",18);case 18:r++,t.next=14;break;case 21:case"end":return t.stop()}}),t,this,[[4,9]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"onPause",value:function(){this.mgr&&this.mgr.stopMoveTo()}},{key:"parseProgress",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n,a,r){var i,o,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=this.next[r]||{index:0,errorTime:0},n===this.fragmentIndex?(o=e[i.index],s=e[i.index-1]):(o=e[0],s=a?a.pop():null),o){t.next=18;break}if(e.length&&!(this.control.count<=this.fragmentIndex+1)){t.next=8;break}return this.mgr&&this.mgr.remove(r),t.abrupt("return",Promise.reject());case 8:return t.prev=8,t.next=11,O["a"].getItem(this.fragmentIndex+1+"");case 11:return c=t.sent,t.abrupt("return",this.parseProgress(c[r]||[],n,a,r));case 15:return t.prev=15,t.t0=t["catch"](8),t.abrupt("return",this.showLoading());case 18:return t.abrupt("return",{target:o,prev:s,record:i});case 19:case"end":return t.stop()}}),t,this,[[8,15]])})));function e(e,n,a,r){return t.apply(this,arguments)}return e}()},{key:"start",value:function(t,e){if(this.mgr&&this.date&&this.date.length>=2){var n=this.timeRange*this.progress/100,a=t.time-this.date[0];n>=a&&(this.mgr.addImage({x:t.x,y:t.y,height:.5,url:this.icons.get(e),size:48},e,void 0,!1),this.renderTags.add(e),this.next[e]={index:1,errorTime:0})}}},{key:"getFragment",value:function(){var t=this;return Promise.resolve().then((function(){var e=t.control.index;return e!==t.fragmentIndex?(t.fragmentIndex=e,O["a"].getItem(e+"")):t.points})).then((function(e){return t.points=e})).catch(this.showLoading.bind(this))}},{key:"showLoading",value:function(){return this.isLoading=!0,this.control.pause(),Promise.reject("loading...")}},{key:"timeRange",get:function(){return!this.date||this.date.length<2?0:this.date[1]-this.date[0]}}]),e}(Object(h["c"])(d["a"]));Object(f["a"])([Object(y["e"])("control")],M.prototype,"control",void 0),M=Object(f["a"])([Object(h["b"])({components:{"history-control":T}})],M);var z=M,N=z,R=n("e87d");function E(t){this["$style"]=R["default"].locals||R["default"]}var I=Object(C["a"])(N,a,r,!1,E,null,null);e["default"]=I.exports},"5eed":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"padding-left":"5%","padding-top":"3%"}},[t._m(0),n("map-form",{ref:"form",on:{submit:t.onSubmit}})],1)},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("h3",{staticStyle:{color:"#009688"}},[t._v("\n        地图添加\n        "),n("span",{staticStyle:{"font-size":"12px"}},[t._v('\n            (注意: 如果地图文件是fengmap文件, 需将其对应的主题文件夹放入\n            "/data/theme/" 目录)\n        ')])])}],i=(n("7f7f"),n("28a5"),n("d225")),o=n("b0b4"),s=n("308d"),c=n("6bb5"),l=n("4e2b"),u=n("9ab4"),p=n("2fe1"),f=n("2b0e"),h=n("da56"),d=function(t){function e(){return Object(i["a"])(this,e),Object(s["a"])(this,Object(c["a"])(e).apply(this,arguments))}return Object(l["a"])(e,t),Object(o["a"])(e,[{key:"onSubmit",value:function(t){var e=this;this.$http.post("/api/map/upload/mapfile",{file:t.map,mapName:t.map.name.split(".")[0]||"map"}).then((function(n){var a=t.minX,r=t.maxX,i=t.minY,o=t.maxY;return e.$http.post({url:"/api/map/addMap",body:{filepath:n.resultMap.mapUrl,name:t.name,groupCode:JSON.stringify(t.groupCode),margin:JSON.stringify([[a,i],[a,o],[r,o],[r,i],[t.width,t.height]])},headers:{"Content-Type":"application/json"}})})).then((function(){e.$message.success("添加成功"),e.$refs.form.reset()})).catch(console.log)}}]),e}(f["default"]);d=Object(u["a"])([Object(p["b"])({components:{"map-form":h["a"]}})],d);var m=d,g=m,b=n("2877"),v=Object(b["a"])(g,a,r,!1,null,null,null);e["default"]=v.exports},"69b2":function(t,e,n){},"6ed6":function(t,e,n){"use strict";n("7f7f"),n("20d6");var a=n("d225"),r=n("b0b4"),i=n("308d"),o=n("6bb5"),s=n("4e2b"),c=n("9ab4"),l=n("2b0e"),u=n("2fe1"),p=n("93f3"),f=function(t){function e(){var t;return Object(a["a"])(this,e),t=Object(i["a"])(this,Object(o["a"])(e).apply(this,arguments)),t.operation=[{type:{default:"primary"},name:"display",desc:{default:"显示"}}],t}return Object(s["a"])(e,t),Object(r["a"])(e,[{key:"display",value:function(t,e,n){var a=this.getOperation(),r=a.findIndex((function(t){return"display"===t.name}));if(r>-1){var i=a[r];i.type[t.id]||n?(i.type[t.id]=void 0,this.removeZone(t)):(i.type[t.id]="success",this.showZone(t)),i.desc[t.id]=i.desc[t.id]||n?void 0:"隐藏",this.$set(a,r,i)}return this}},{key:"getOperation",value:function(){return this.operation}},{key:"removeZone",value:function(t){this.mgr&&this.mgr.remove(t.id+p["t"]+t.name)}},{key:"showZone",value:function(t){this.mgr&&this.mgr.zoneOpen(t)}}]),e}(l["default"]);f=Object(c["a"])([u["b"]],f),e["a"]=f},7833:function(t,e,n){"use strict";var a=n("8a47"),r=n.n(a);e["default"]=r.a},8615:function(t,e,n){var a=n("5ca1"),r=n("504c")(!1);a(a.S,"Object",{values:function(t){return r(t)}})},"89b9":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"root",staticClass:"map-box",on:{click:t.hiddenCover}},[n("div",{staticClass:"map-tool-bar flex-center",class:t.$style["tool-bar"]},[n("map-select",{on:{selectmap:t.selectMap}}),n("div",{staticClass:"flex-center"},[n("el-input",{staticStyle:{"max-width":"350px","margin-right":"10px"},attrs:{placeholder:"请输入"+(t.isName?"标签名":"标签号"),type:"search"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.find(e)}},model:{value:t.findTarget,callback:function(e){t.findTarget=e},expression:"findTarget"}},[n("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend","popper-append-to-body":!1},slot:"prepend",model:{value:t.isName,callback:function(e){t.isName=e},expression:"isName"}},[n("el-option",{attrs:{value:0,label:"标签号"}}),n("el-option",{attrs:{value:1,label:"标签名"}})],1)],1)],1)],1),n("el-switch",{class:t.$style.switch,attrs:{"active-text":"显示轨迹","inactive-text":"隐藏轨迹","active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.showPath,callback:function(e){t.showPath=e},expression:"showPath"}}),n("div",{ref:"map",staticStyle:{height:"100%",overflow:"hidden"}}),n("div",{class:t.$style.tools},t._l(t.tools,(function(e,a){return n("el-button",{directives:[{name:"show",rawName:"v-show",value:e.display&&3!==a,expression:"v.display && i !== 3"}],key:a,class:t.$style["tool-item"],attrs:{type:e.active?"primary":""},on:{click:function(e){return e.stopPropagation(),t.swithDisplay(a)}}},[t._v("\n            "+t._s(e.name)+"\n        ")])})),1),n("transition",{attrs:{name:"el-zoom-in-bottom"}},[t.tools[4].active?n("Census",{attrs:{zones:t._f("mode")(t.zones,t.zoneMode.group),censusTags:t.census,censusChange:t.censusChange},on:{close:function(e){t.tools[4].active=!1}}}):t._e()],1),n("transition",{attrs:{name:"el-fade-in-linear"}},[t.tools[2].active?n("Zone",{staticStyle:{opacity:"0.7"},attrs:{zones:t.zones,zoneOp:t.operation}}):t._e()],1)],1)},r=[],i=(n("4f7f"),n("96cf"),n("3b8d")),o=(n("ac6a"),n("5df3"),n("f400"),n("d225")),s=n("b0b4"),c=n("308d"),l=n("6bb5"),u=n("4e2b"),p=n("9ab4"),f=n("2fe1"),h=n("ae85"),d=n("2b0e"),m=function(t){function e(){return Object(o["a"])(this,e),Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments))}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"destroyed",value:function(){this.remove&&this.remove()}},{key:"on",value:function(t,e){var n=this;this.remove=function(){return n.$event.off(t,e)},this.$event.on(t,e)}}]),e}(d["default"]);m=Object(p["a"])([f["b"]],m);var g=m,b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{on:{click:function(t){t.stopPropagation()}}},[n("el-card",{ref:"table",staticClass:"card",class:t.$style.box},[n("el-select",{staticStyle:{"margin-bottom":"10px"},attrs:{multiple:"",placeholder:"区域类型",size:"mini"},on:{change:function(e){return t.getData(1,t.pageSize)}},model:{value:t.modes,callback:function(e){t.modes=e},expression:"modes"}},t._l(t.modeDescript,(function(e,a){return n("el-option",{directives:[{name:"show",rawName:"v-show",value:Object.values(t.zoneMode).includes(a),expression:"Object.values(zoneMode).includes(i)"}],key:e,attrs:{label:e,value:a}})})),1),n("app-table",{attrs:{"max-height":500,"table-data":t.tableData,"col-cfg":t.colCfg,"total-count":t.totalCount,op:t.zoneOp,isSmall:!0,noPrint:!0},on:{switch:t.display,updateData:t.getData}})],1)],1)},v=[],y=(n("8e6e"),n("456d"),n("d185"),n("bd86")),O=(n("6762"),n("2fdb"),n("60a3")),j=n("cda1"),w=n("6ed6");function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function k(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(n,!0).forEach((function(e){Object(y["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var _=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.modes=[],t.colCfg=[{prop:"name",label:"区域"},{prop:"status",label:"状态"}],t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"getOperation",value:function(){return this.zoneOp||[]}},{key:"fetch",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var a,r,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=this.zones,this.modes.length&&(a=this.zones.filter((function(t){return i.modes.includes(t.mode)}))),r=a.slice((e-1)*n,e*n),t.abrupt("return",{count:a.length,data:r.map((function(t){var e=k({},t);return e.status=t.enable?"开启":"关闭",e.position="string"===typeof t.position?JSON.parse(t.position):t.position,e}))});case 4:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"mgr",get:function(){return this.$parent&&Reflect.get(this.$parent,"mgr")}}]),e}(Object(f["c"])(h["a"],w["a"]));Object(p["a"])([j["a"]],_.prototype,"zoneMode",void 0),Object(p["a"])([j["a"]],_.prototype,"modeDescript",void 0),Object(p["a"])([Object(O["d"])()],_.prototype,"zones",void 0),Object(p["a"])([Object(O["d"])()],_.prototype,"zoneOp",void 0),_=Object(p["a"])([f["b"]],_);var P=_,$=P,C=n("fcc3"),S=n("2877");function D(t){this["$style"]=C["default"].locals||C["default"]}var T=Object(S["a"])($,b,v,!1,D,null,null),M=T.exports,z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{on:{click:function(t){t.stopPropagation()}}},[n("el-card",{ref:"table",staticClass:"card",class:t.$style.box},[n("app-table",{attrs:{"max-height":500,"table-data":t.tableData,"col-cfg":t.colCfg,"total-count":t.totalCount,op:[{type:"danger",name:"switch",desc:"切换显示"}],isSmall:!0,noPrint:!0},on:{switch:t.switchZone,updateData:t.getData}})],1)],1)},N=[],R=(n("ffc1"),function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.colCfg=[{prop:"id",label:"分组"}],t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"switchZone",value:function(t){if(this.$parent){var e=Reflect.get(this.$parent,"mgr");e&&t.children.forEach((function(t){return e.show(t.baseNo)}))}}},{key:"fetch",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=Object.entries(this.group).slice((e-1)*n,e*n),t.abrupt("return",{count:a.length,data:a.map((function(t){return{id:t[0],children:t[1]}}))});case 2:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()}]),e}(Object(f["c"])(h["a"])));Object(p["a"])([Object(O["d"])()],R.prototype,"group",void 0),R=Object(p["a"])([f["b"]],R);var E=R,I=E,L=n("932b");function A(t){this["$style"]=L["default"].locals||L["default"]}var F=Object(S["a"])(I,z,N,!1,A,null,null),W=F.exports,H=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{on:{click:function(t){t.stopPropagation()}}},[n("el-card",{class:t.$style.box},[n("div",{attrs:{slot:"header"},slot:"header"},[n("span",[t._v("标签统计")]),n("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",icon:"el-icon-close"},on:{click:function(e){return t.$emit("close")}}})],1),n("el-form",{staticStyle:{margin:"0 auto 30px"}},[n("el-form-item",{attrs:{label:"选择区域"}},[n("el-select",{attrs:{filterable:""},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.zones,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.base_no_1}})})),1)],1)],1),n("div",{staticStyle:{"text-align":"center"}},[n("div",{staticStyle:{"border-bottom":"1px solid #ccc","margin-bottom":"5px"}},[t._v("\n                当前地图标签数量: "+t._s(t.allCount)+"\n            ")]),n("div",{directives:[{name:"show",rawName:"v-show",value:!!t.info,expression:"!!info"}],staticStyle:{"margin-top":"10px"}},[n("span",[t._v(t._s((t.info||{}).name)+"标签数量: ")]),n("span",[t._v("\n                    "+t._s((t.info||{}).true)+"\n                    ")])]),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.info&&""!==t.value,expression:"!info && value !== ''"}]},[n("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"24px"}})])])],1)],1)},U=[],G=n("75fc"),q=(n("1c4c"),n("aef6"),n("7f7f"),n("7514"),function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.value="",t.allCount=0,t.info=null,t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){this.allCount=this.getAllCount()}},{key:"getInfo",value:function(){var t=this;if(this.zones&&this.censusTags){this.allCount=this.getAllCount();var e=this.zones.find((function(e){return e.baseNo1===t.value}));if(e)return this.info={name:e.name+(e.name.endsWith("区域")?"":"区域"),true:(this.censusTags.get(this.value)||new Set).size};this.info=null}}},{key:"getAllCount",value:function(){return Array.from(this.censusTags.values()).flatMap((function(t){return Object(G["a"])(t)})).length}}]),e}(d["default"]));Object(p["a"])([Object(O["d"])()],q.prototype,"zones",void 0),Object(p["a"])([Object(O["d"])()],q.prototype,"censusTags",void 0),Object(p["a"])([Object(O["d"])()],q.prototype,"censusChange",void 0),Object(p["a"])([Object(O["f"])("censusChange"),Object(O["f"])("value")],q.prototype,"getInfo",null),q=Object(p["a"])([f["b"]],q);var J=q,X=J,Z=n("1896");function Y(t){this["$style"]=Z["default"].locals||Z["default"]}var V=Object(S["a"])(X,H,U,!1,Y,null,null),K=V.exports,B=(n("9253"),n("768b")),Q=(n("ac4d"),n("8a81"),n("8615"),n("b3c9")),tt=(n("a481"),n("d8c9")),et=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.groups=[],t.ws=[],t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){var t=this;this.tagAll={},this.$http.get("/api/tag/getall",{currentPage:1,pageSize:1e8}).then((function(e){return t.tagAll=Object(tt["b"])(e.pagedData.datas,"tagNo",!1)})).catch((function(){return console.log}))}},{key:"beforeDestroy",value:function(){this.closeWebSocket(),this.tagAll={}}},{key:"initWebSocket",value:function(){var t=this;this.closeWebSocket();var e=Object(tt["f"])();if(e){var n=function(e){var n=JSON.parse(e.data);t.tagAll[n.sTagNo]&&n.position.every((function(t){return+t>=0}))&&t.doMonitor(n)},a=Object(tt["e"])("websoket.position","ws://#{ip}/realtime/position"),r=new WebSocket("".concat(a.replace("#{ip}",e),"/").concat(this.groups.join(",")));r.onmessage=n,this.ws=[r]}}},{key:"doMonitor",value:function(t){}},{key:"closeWebSocket",value:function(){var t=this.ws.pop();while(t)t.close(),t.onmessage=null,t=this.ws.pop();return this}}]),e}(d["default"]);et=Object(p["a"])([f["b"]],et);var nt=n("93f3"),at=(n("ba16"),n("b54a"),function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.bindings=new Map,t.points=new Map,t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){var t=this,e=[{id:1,tags:["00000004","00000005"]},{id:2,tags:["00000001","00000008"]},{id:3,tags:["00000001","00000011"]}];this.normalize(e),this.missHandler=function(e){e.alarmMsg===nt["m"]&&t.link(e.tagNo)},this.$event.on(nt["p"],this.missHandler)}},{key:"destroyed",value:function(){this.missHandler&&this.$event.off(nt["p"],this.missHandler)}},{key:"link",value:function(t,e){var n=this,a=this.getAngRecordPoints(t,e);a.forEach((function(t){if(n.mgr)for(var e=0,a=Object.entries(t);e<a.length;e++){var r=Object(B["a"])(a[e],2),i=r[0],o=r[1],s="link_"+i;n.mgr.lineMgr.remove(s),o.length<2||(o.length>2&&o.push(o[0]),n.mgr.addLine(o,{lineType:fengmap.FMLineType.FULL,lineWidth:2,smooth:!1,color:"#e00",colorNum:15597568},s))}}))}},{key:"getAngRecordPoints",value:function(t,e){var n=this,a=this.bindings.get(t);return a?a.map((function(a){var r=n.points.get(a)||{};return e?r[t]=e:Reflect.deleteProperty(r,t),n.points.set(a,r),Object(y["a"])({},a,Object.values(r))})):[]}},{key:"normalize",value:function(t){var e=this;t.forEach((function(t){var n=Array.isArray(t.tags)?t.tags:JSON.parse(t.tags);n.forEach((function(n){var a=e.bindings.get(n)||[];a.push(t.id),e.bindings.set(n,a)}))}))}}]),e}(d["default"]));at=Object(p["a"])([f["b"]],at);var rt=at,it=n("2f98");function ot(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function st(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ot(n,!0).forEach((function(e){Object(y["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ot(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var ct=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.renderTags={},t.pops=new Map,t.moveTime=1/Object(tt["e"])("SECOND_COUNT",1),t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){var t=this;this.$event.on(nt["n"],(function(e,n){return t.mgr&&t.mgr.modifyImg(e,n)}))}},{key:"beforeDestroy",value:function(){this.$event.off(nt["n"]),Object.values(this.renderTags).forEach(clearTimeout),this.pops.forEach((function(t){return t.close()}))}},{key:"showInfo",value:function(t,e){var n=this;if(this.mgr&&!this.pops.has(t)){var a=this.mgr.find(t,!!e);a.length?a.forEach((function(t){var e=Object(it["c"])(t,"info").name;e&&n.pops.set(e,n.mgr.addPopInfo(t))})):this.$message.info("未找到标签".concat(t,"为").concat(t,"的标签"))}}},{key:"bindEvents",value:function(){var t=this;this.mgr.on("loadComplete",this.mapCreated.bind(this)),this.mgr.on("mapClickNode",(function(e){if(t.mgr){var n=Object(it["c"])(e.target,"info").tagNo;if(e.nodeType===fengmap.FMNodeType.IMAGE_MARKER&&n)t.pops.has(n)||t.pops.set(n,t.mgr.addPopInfo(e.target));else{var a=!0,r=!1,i=void 0;try{for(var o,s=t.pops.entries()[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var c=Object(B["a"])(o.value,2),l=c[0],u=c[1];u.close()&&t.pops.delete(l)}}catch(p){r=!0,i=p}finally{try{a||null==s.return||s.return()}finally{if(r)throw i}}}}}))}},{key:"afterMapCreated",value:function(){}},{key:"doCensus",value:function(t){}},{key:"doMonitor",value:function(t){var e=this;if(!this.mgr)return console.log("获取地图失败!!");var n=t.sTagNo,a=this.renderTags[n],r={x:+t.position[0],y:+t.position[1],z:1};if(a){clearTimeout(a);var i=function(){var a=e.pops.get(n);a&&a.update&&(a.update(t.iHeartRate)||e.pops.delete(n))};+t.position[2]>=1e3?(this.exitAnimation(n),i()):this.moveTo(n,r,this.moveTime,i)}else this.addTag(n,r),this.renderTags[n]=1;t.static||(this.renderTags[n]=setTimeout(this.miss.bind(this,n),nt["i"])),this.doCensus(t)}},{key:"miss",value:function(t){this.$event.emit(nt["l"],t),this.mgr&&(this.renderTags[t]=-1,this.mgr.show(t,!1),this.mgr.lineMgr.remove(t),this.doCensus(t),this.pops.has(t)&&(this.pops.get(t).close(!0),this.pops.delete(t)))}},{key:"mapCreated",value:function(){var t=this;Object.values(this.renderTags).forEach(clearTimeout),this.renderTags={},this.pops.forEach((function(t){return t.close()})),this.pops.clear(),this.showPath=!1,this.tagAnchor().then((function(e){return Reflect.set(t,"groupData",Object(tt["b"])(e,"groupCode"))})),this.afterMapCreated()}},{key:"addTag",value:function(t,e){var n=[];try{n=this.mgr.map.groupIDs||[]}catch(r){return}var a=this.tagAll[t];this.addIcon(n[0]||0,st({},a,{},e,{name:t,tagName:a.name}))}}]),e}(Object(f["c"])(Q["a"],et,rt));ct=Object(p["a"])([f["b"]],ct);var lt=ct,ut=n("0876"),pt=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.groupData={},t.zones=[],t.operation=[{type:{default:"primary"},name:"display",desc:{default:"显示"}}],t.tools=[{name:"2D",active:!0,display:!0},{name:"3D",active:!1,display:!1},{name:"区域列表",active:!1,display:!0},{name:"分组列表",active:!1,display:!0},{name:"统计",active:!1,display:!0}],t.isFullScreen=!1,t.findTarget="",t.isName=0,t.censusChange=0,t.censusTags=new Map,t.tagGroup=new Map,t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){var t=this;this.on(nt["r"],(function(){t.isFullScreen=!!document.fullscreenElement,t.container&&t.mgr instanceof ut["a"]&&t.mgr.map.resize(t.container.offsetWidth,t.container.offsetHeight)}))}},{key:"swithDisplay",value:function(t){var e=this.tools[t];if(t<2){if(e.active)return;var n=this.tools[t?0:1];n.active=!n.active,this.mgr&&this.mgr.switchViewMode(t?fengmap.FMViewMode.MODE_3D:fengmap.FMViewMode.MODE_2D)}if(e.active=!e.active,2===t||3===t){var a=this.tools[2===t?3:2];e.active&&(a.active=!1)}}},{key:"hiddenCover",value:function(){for(var t=2;t<this.tools.length;t++)this.tools[t].active=!1}},{key:"find",value:function(){if(!this.findTarget)return this.$message.warning("标签名");this.showInfo(this.findTarget,this.isName),this.findTarget=""}},{key:"fullScreen",value:function(){document.fullscreenElement?document.exitFullscreen():this.root&&this.root.requestFullscreen()}},{key:"initData",value:function(){this.initWebSocket(),this.tools[0].active=!0,this.tools[1].active=!1,this.findTarget="";for(var t=2;t<this.tools.length;t++)this.tools[t].active=!1}},{key:"afterMapCreated",value:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.tools[1].display=!!this.mgr&&this.mgr.has3D,t.next=3,this.$http.get("/api/zone/getall",{currentPage:1,pageSize:1e8,mapId:this.mapId});case 3:this.zones=t.sent.pagedData.datas;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"doCensus",value:function(t){var e=t.sTagNo||t,n=this.tagGroup.get(e),a=!1;if(n){var r=this.censusTags.get(n);a=!(!r||!r.delete(e))}if("string"!==typeof t){var i=this.censusTags.get(t.sGroupNo)||new Set,o=i.size;i.add(e),a=a||o!==i.size,this.censusTags.set(t.sGroupNo,i),this.tagGroup.set(e,t.sGroupNo)}if(a){var s=Date.now();(!this.time||s-this.time>=1e3)&&(this.censusChange=this.censusChange?0:1,this.time=s)}}},{key:"census",get:function(){var t=this.censusChange;return console.log(t),this.censusTags}}]),e}(Object(f["c"])(lt,h["a"],g));Object(p["a"])([j["a"]],pt.prototype,"zoneMode",void 0),Object(p["a"])([Object(O["e"])("root")],pt.prototype,"root",void 0),Object(p["a"])([Object(tt["a"])()],pt.prototype,"afterMapCreated",null),pt=Object(p["a"])([Object(f["b"])({components:{Zone:M,Group:W,Census:K},filters:{mode:function(t,e){return t.filter((function(t){return t.mode===e}))}}})],pt);var ft=pt,ht=ft,dt=n("0a43");function mt(t){this["$style"]=dt["default"].locals||dt["default"]}var gt=Object(S["a"])(ht,a,r,!1,mt,null,null);e["default"]=gt.exports},"8a47":function(t,e,n){t.exports={control:"Control_control_-Xm__",content:"Control_content_8jrU1",progress:"Control_progress_3Owql",item:"Control_item_3l-J0"}},"932b":function(t,e,n){"use strict";var a=n("c055"),r=n.n(a);e["default"]=r.a},a89f:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("app-page",{attrs:{tabs:t.tabs}})},r=[],i=n("d225"),o=n("308d"),s=n("6bb5"),c=n("4e2b"),l=n("9ab4"),u=n("2fe1"),p=n("2b0e"),f=n("719a"),h=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(s["a"])(e).apply(this,arguments)),t.tabs=[{title:"实时监控",to:"/monitor",icon:"el-icon-view"},{title:"历史轨迹",to:"/monitor/history",icon:"el-icon-film"},{title:"地图编辑",to:"/monitor/edit",icon:"el-icon-edit"},{title:"地图添加",to:"/monitor/add",icon:"el-icon-document-add"}],t}return Object(c["a"])(e,t),e}(p["default"]);h=Object(l["a"])([Object(u["b"])({components:{"app-page":f["a"]}})],h);var d=h,m=d,g=n("2877"),b=Object(g["a"])(m,a,r,!1,null,null,null);e["default"]=b.exports},ae85:function(t,e,n){"use strict";n("ac6a"),n("96cf");var a=n("3b8d"),r=n("d225"),i=n("b0b4"),o=n("308d"),s=n("6bb5"),c=n("4e2b"),l=n("9ab4"),u=n("2b0e"),p=n("2fe1"),f=n("d8c9"),h=n("60a3"),d=n("ab30"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-table",{staticStyle:{"margin-bottom":"10px"},attrs:{data:t.tableData,border:!0,"max-height":t.maxHeight,"header-row-class-name":"table-thead"}},[t._l(t.colCfg,(function(t,e){return n("el-table-column",{key:e,attrs:{"show-overflow-tooltip":"",prop:t.prop,label:t.label,resizable:!0,"min-width":null==t.width?void 0:t.width}})})),t.op&&t.op.length?n("el-table-column",{attrs:{label:"操作",resizable:!0,"min-width":null==t.opWidth?void 0:t.opWidth},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"flex-center"},t._l(t.op,(function(a,r){return n("el-button",{key:r,attrs:{size:"mini","v-show":!e.row.hidden,type:t._f("parse")(a.type,e.row),disabled:!!a.isDisable&&a.isDisable(e.row)},on:{click:function(n){return t.emit(a.name,e.row,e.$index)}}},[t._v("\n                        "+t._s(t._f("parse")(a.desc,e.row))+"\n                    ")])})),1)]}}],null,!1,2422452652)}):t._e()],2),n("div",{staticClass:"flex-center",staticStyle:{"justify-content":"space-between"}},[t.noPrint?t._e():n("el-button",{attrs:{size:"mini",icon:"el-icon-printer"},on:{click:function(e){return t.emit("toExcel")}}},[t._v("\n            导出\n        ")]),n("el-pagination",{attrs:{"current-page":t.page,"page-size":t.pageSize,layout:(t.isSmall?"":"sizes, ")+"prev, pager, next",total:t.totalCount,small:!!t.isSmall,"hide-on-single-page":!!t.isSmall,"pager-count":5},on:{"size-change":function(e){return t.updateData("pageSize",e)},"current-change":function(e){return t.updateData("page",e)}}})],1)],1)},g=[],b=function(t){function e(){var t;return Object(r["a"])(this,e),t=Object(o["a"])(this,Object(s["a"])(e).apply(this,arguments)),t.pageSize=10,t.page=1,t}return Object(c["a"])(e,t),Object(i["a"])(e,[{key:"emit",value:function(t,e,n){t=y(t,e),this.$emit(t,e,n)}},{key:"updateData",value:function(t,e){var n=this;this[t]=e,this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout((function(){return n.$emit("updateData",n.page,n.pageSize)}),200)}}]),e}(u["default"]);Object(l["a"])([Object(h["d"])()],b.prototype,"maxHeight",void 0),Object(l["a"])([Object(h["d"])()],b.prototype,"tableData",void 0),Object(l["a"])([Object(h["d"])()],b.prototype,"totalCount",void 0),Object(l["a"])([Object(h["d"])()],b.prototype,"colCfg",void 0),Object(l["a"])([Object(h["d"])()],b.prototype,"op",void 0),Object(l["a"])([Object(h["d"])()],b.prototype,"noPrint",void 0),Object(l["a"])([Object(h["d"])()],b.prototype,"isSmall",void 0),Object(l["a"])([Object(h["d"])()],b.prototype,"opWidth",void 0),b=Object(l["a"])([Object(p["b"])({filters:{parse:y}})],b);var v=b;function y(t,e){return"string"===typeof t?t:t[e.id]||t.default||"404"}var O=v,j=n("2877"),w=Object(j["a"])(O,m,g,!1,null,null,null),x=w.exports,k=function(t){function e(){var t;return Object(r["a"])(this,e),t=Object(o["a"])(this,Object(s["a"])(e).apply(this,arguments)),t.totalCount=0,t.tableData=[],t.maxHeight=100,t.colCfg=[],t.pageSize=10,t.page=1,t}return Object(c["a"])(e,t),Object(i["a"])(e,[{key:"created",value:function(){this.getData(1,10)}},{key:"mounted",value:function(){this.getMaxHeight()}},{key:"getData",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e,n){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.pageSize=n,this.page=e,t.next=4,this.fetch(e,n);case 4:a=t.sent,this.totalCount=a.count,this.tableData=a.data;case 7:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"toExcel",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.bodyStr();case 2:e=t.sent,Object(d["c"])(this.headStr()+e);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"fetch",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",{count:0,data:[]});case 1:case"end":return t.stop()}}),t)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"refresh",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;return null==e&&(e=t?this.tableData.length>1?this.page:this.page-1:this.page),this.getData(Math.max(1,e),this.pageSize),this}},{key:"headStr",value:function(){var t=["<thead><tr>"];return this.colCfg.forEach((function(e){return t.push("<th>".concat(e.label,"</th>"))})),t.push("</tr></thead>"),t.join("")}},{key:"bodyStr",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,n,a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.fetch(this.page,Math.min(this.totalCount,2e3));case 2:return e=t.sent.data,n=["<tbody>"],e.forEach((function(t){n.push("<tr>"),a.colCfg.forEach((function(e){return n.push("<td style=\"mso-number-format:'@'\">".concat(null==t[e.prop]?" ":t[e.prop],"</td>"))})),n.push("</tr>")})),n.push("</tbody>"),t.abrupt("return",n.join(""));case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getMaxHeight",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.$refs.table,!e){t.next=13;break}if(n=e.$el||e,!n){t.next=13;break}return t.prev=4,t.next=7,Object(f["h"])((function(){return!!n.offsetHeight}));case 7:this.maxHeight=.85*n.offsetHeight,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](4),console.log(t.t0);case 13:case"end":return t.stop()}}),t,this,[[4,10]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"op",get:function(){return this.permission&&this.permission.delete?[{type:"danger",name:"del",desc:"删除"}]:[]}}]),e}(u["default"]);Object(l["a"])([Object(h["d"])()],k.prototype,"permission",void 0),k=Object(l["a"])([Object(p["b"])({components:{"app-table":x}})],k);e["a"]=k},aef6:function(t,e,n){"use strict";var a=n("5ca1"),r=n("9def"),i=n("d2c8"),o="endsWith",s=""[o];a(a.P+a.F*n("5147")(o),"String",{endsWith:function(t){var e=i(this,t,o),n=arguments.length>1?arguments[1]:void 0,a=r(e.length),c=void 0===n?a:Math.min(r(n),a),l=String(t);return s?s.call(e,l,c):e.slice(c-l.length,c)===l}})},baf6:function(t,e,n){"use strict";var a=n("69b2"),r=n.n(a);r.a},c055:function(t,e,n){t.exports={box:"Group_box_MIaUk"}},c8d5:function(t,e,n){"use strict";var a=n("066f"),r=n.n(a);e["default"]=r.a},cda1:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n("2fe1"),r=n("2f62"),i=o("computed",r["e"]);o("computed",r["c"]),o("methods",r["b"]),o("methods",r["d"]);function o(t,e){function n(n,r){return Object(a["a"])((function(a,i){a[t]||(a[t]={});var o,s=(o={},o[i]=n,o);a[t][i]=void 0!==r?e(r,s)[i]:e(s)[i]}))}function r(t,e){if("string"===typeof e){var a=e,r=t;return n(a,void 0)(r,a)}var i=s(e),o=t;return n(o,i)}return r}function s(t){var e=t&&t.namespace;if("string"===typeof e)return"/"!==e[e.length-1]?e+"/":e}},da56:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{ref:"form",attrs:{"label-width":"auto",model:t.form}},[n("el-form-item",{attrs:{label:"地图名称",prop:"name",required:""}},[n("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"请输入地图名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._l(["minX","maxX","minY","maxY"],(function(e){return n("el-form-item",{key:e,attrs:{label:e,prop:e,required:""}},[n("el-input-number",{attrs:{step:100,placeholder:"地图坐标"},model:{value:t.form[e],callback:function(n){t.$set(t.form,e,n)},expression:"form[k]"}})],1)})),n("el-form-item",{attrs:{label:"地图大小",required:""}},[n("el-form-item",{class:t.$style.inline,attrs:{required:"",prop:"width"}},[n("el-input-number",{attrs:{step:100,placeholder:"宽(定位)"},model:{value:t.form.width,callback:function(e){t.$set(t.form,"width",e)},expression:"form.width"}})],1),n("el-form-item",{class:t.$style.inline,staticStyle:{"margin-left":"20px"},attrs:{required:"",prop:"height"}},[n("el-input-number",{attrs:{step:100,placeholder:"高(定位)"},model:{value:t.form.height,callback:function(e){t.$set(t.form,"height",e)},expression:"form.height"}})],1)],1),n("el-form-item",{attrs:{required:"",label:"地图"}},[n("el-upload",{attrs:{"auto-upload":!1,action:"","show-file-list":!1,"on-change":t.changeUpload}},[n("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-upload"}},[t._v("\n                选择文件\n            ")]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t.form.url?n("img",{class:t.$style.img,attrs:{src:t.form.url}}):[t._v("\n                    "+t._s(t.form.filename||"只能上传jpg/png/fmp文件，且不超过5M")+"\n                ")]],2)],1)],1),n("el-form-item",[n("el-button",{attrs:{type:"success"},on:{click:t.submit}},[t._v("立即提交")])],1)],2)},r=[],i=(n("8e6e"),n("ac6a"),n("456d"),n("bd86")),o=(n("7f7f"),n("aef6"),n("d225")),s=n("b0b4"),c=n("308d"),l=n("6bb5"),u=n("4e2b"),p=n("9ab4"),f=n("2b0e"),h=n("2fe1"),d=n("60a3");function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(n,!0).forEach((function(e){Object(i["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var b=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.form={url:"",filename:"",map:null,name:"",groupCode:[]},t.changeUpload=null,t}return Object(u["a"])(e,t),Object(s["a"])(e,[{key:"created",value:function(){var t=this;this.changeUpload=function(e){if("image/png"!==e.raw.type&&"image/jpeg"!==e.raw.type&&!e.name.endsWith(".fmap"))return t.$message.error("只能上传jpg/png/fmag文件!");if(e.size/1024/1024>5)return t.$message.error("上传文件大小不能超过 5MB!");if(e.name.endsWith(".fmap"))t.form.url="",t.form.filename=e.name;else{var n=new FileReader;n.onload=function(e){t.form.filename="",t.form.url=e.target.result},n.readAsDataURL(e.raw)}t.form.map=e.raw}}},{key:"submit",value:function(){var t=this,e=this.$refs.form;e.validate().then((function(){if(!(t.form.map||t.form.url||t.form.filename))return t.$message.warning("地图文件不能为空");t.$emit("update:data",t.form),t.$emit("submit",t.form)})).catch(console.log)}},{key:"reset",value:function(){return this.$refs.form.resetFields(),this.form.map=null,this.form.url=this.form.filename="",{}}},{key:"assignForm",value:function(){this.form=g({},this.data)}}]),e}(f["default"]);Object(p["a"])([Object(d["d"])({default:function(){return{}}})],b.prototype,"data",void 0),Object(p["a"])([Object(d["b"])("update:data")],b.prototype,"reset",null),Object(p["a"])([Object(d["f"])("data")],b.prototype,"assignForm",null),b=Object(p["a"])([h["b"]],b);var v=b,y=v,O=n("c8d5"),j=n("2877");function w(t){this["$style"]=O["default"].locals||O["default"]}var x=Object(j["a"])(y,a,r,!1,w,null,null);e["a"]=x.exports},e87d:function(t,e,n){"use strict";var a=n("09a4"),r=n.n(a);e["default"]=r.a},fcc3:function(t,e,n){"use strict";var a=n("1637"),r=n.n(a);e["default"]=r.a}}]);
//# sourceMappingURL=map.317b7fea.js.map