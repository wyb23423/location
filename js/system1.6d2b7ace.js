(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["system1"],{1422:function(e,t,n){e.exports={box:"Fence_box_2lT68","tool-bar":"Fence_tool-bar_2FZ4x",op:"Fence_op_1V_MP",form:"Fence_form_vw2BH",submit:"Fence_submit_Thr33",point:"Fence_point_16SnX"}},"1c13":function(e,t,n){e.exports={thead:"Table_thead_gYJvz"}},"20fd":function(e,t,n){"use strict";var a=n("d9f6"),r=n("aebd");e.exports=function(e,t,n){t in e?a.f(e,t,r(0,n)):e[t]=n}},"3c06":function(e,t,n){"use strict";var a=n("1c13"),r=n.n(a);t["default"]=r.a},"549b":function(e,t,n){"use strict";var a=n("d864"),r=n("63b6"),o=n("241e"),i=n("b0dc"),s=n("3702"),c=n("b447"),l=n("20fd"),u=n("7cd6");r(r.S+r.F*!n("4ee1")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,r,p,f=o(e),h="function"==typeof this?this:Array,d=arguments.length,m=d>1?arguments[1]:void 0,b=void 0!==m,v=0,g=u(f);if(b&&(m=a(m,d>2?arguments[2]:void 0,2)),void 0==g||h==Array&&s(g))for(t=c(f.length),n=new h(t);t>v;v++)l(n,v,b?m(f[v],v):f[v]);else for(p=g.call(f),n=new h;!(r=p.next()).done;v++)l(n,v,b?i(p,m,[r.value,v],!0):r.value);return n.length=v,n}})},"54a1":function(e,t,n){n("6c1c"),n("1654"),e.exports=n("95d5")},"75fc":function(e,t,n){"use strict";var a=n("a745"),r=n.n(a);function o(e){if(r()(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}var i=n("774e"),s=n.n(i),c=n("c8bb"),l=n.n(c);function u(e){if(l()(Object(e))||"[object Arguments]"===Object.prototype.toString.call(e))return s()(e)}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function f(e){return o(e)||u(e)||p()}n.d(t,"a",function(){return f})},"774e":function(e,t,n){e.exports=n("d2d5")},"95d5":function(e,t,n){var a=n("40c3"),r=n("5168")("iterator"),o=n("481b");e.exports=n("584a").isIterable=function(e){var t=Object(e);return void 0!==t[r]||"@@iterator"in t||o.hasOwnProperty(a(t))}},ae85:function(e,t,n){"use strict";n("ac6a"),n("96cf");var a=n("3b8d"),r=n("d225"),o=n("b0b4"),i=n("308d"),s=n("6bb5"),c=n("4e2b"),l=n("9ab4"),u=n("2b0e"),p=n("2fe1"),f=n("d8c9"),h=n("60a3"),d="data:application/vnd.ms-excel;base64,";function m(e){return window.btoa(decodeURIComponent(encodeURIComponent(e)))}function b(e){return'<html><head><meta charset="UTF-8"></head><body><table border="1">'.concat(e,"</table></body></html>")}function v(e){window.open(d+m(b(e)),"block")}var g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-table",{staticStyle:{"margin-bottom":"10px"},attrs:{data:e.tableData,border:!0,"header-row-class-name":e.$style.thead,"max-height":e.maxHeight}},[e._l(e.colCfg,function(t,a){return n("el-table-column",{key:a,attrs:{prop:t.prop,label:t.label,sortable:!!t.sortable,resizable:!0,width:null==t.width?void 0:t.width*e.scale}})}),e.op&&e.op.length?n("el-table-column",{attrs:{label:"操作",fixed:"right",resizable:!0,"min-width":null==e.opWidth?void 0:e.opWidth*e.scale},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"flex-center"},e._l(e.op,function(a,r){return n("el-button",{key:r,attrs:{size:"mini",type:e._f("parse")(a.type,t.$index)},on:{click:function(n){return e.emit(a.name,t.row,t.$index)}}},[e._v("\n                        "+e._s(e._f("parse")(a.desc,t.$index))+"\n                    ")])}),1)]}}],null,!1,3211734680)}):e._e()],2),n("div",{staticClass:"flex-center",staticStyle:{"justify-content":"space-between"}},[e.noPrint?e._e():n("el-button",{attrs:{size:"mini",icon:"el-icon-printer"},on:{click:function(t){return e.emit("toExcel")}}},[e._v("\n            导出\n        ")]),n("el-pagination",{attrs:{"current-page":e.page,"page-size":e.pageSize,layout:(e.isSmall?"":"sizes, ")+"prev, pager, next",total:e.totalCount,small:!!e.isSmall,"hide-on-single-page":!!e.isSmall,"pager-count":5},on:{"size-change":function(t){return e.updateData("pageSize",t)},"current-change":function(t){return e.updateData("page",t)}}})],1)],1)},y=[],x=n("d70b"),w=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(i["a"])(this,Object(s["a"])(t).apply(this,arguments)),e.pageSize=10,e.page=1,e.scale=1,e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"emit",value:function(e,t,n){e=O(e,n),this.$emit(e,t,n)}},{key:"updateData",value:function(e,t){var n=this;this[e]=t,this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(function(){return n.$emit("updateData",n.page,n.pageSize)},200)}},{key:"scaleRoot",value:function(){document.body.clientWidth<=x["h"]?this.scale=x["h"]/x["d"]:this.scale=1}}]),t}(u["default"]);l["a"]([Object(h["b"])()],w.prototype,"maxHeight",void 0),l["a"]([Object(h["b"])()],w.prototype,"tableData",void 0),l["a"]([Object(h["b"])()],w.prototype,"totalCount",void 0),l["a"]([Object(h["b"])()],w.prototype,"colCfg",void 0),l["a"]([Object(h["b"])()],w.prototype,"op",void 0),l["a"]([Object(h["b"])()],w.prototype,"noPrint",void 0),l["a"]([Object(h["b"])()],w.prototype,"isSmall",void 0),l["a"]([Object(h["b"])()],w.prototype,"opWidth",void 0),w=l["a"]([Object(p["b"])({filters:{parse:O}})],w);var k=w;function O(e,t){return"string"===typeof e?e:e[t]||e.default||"404"}var j=k,$=n("3c06"),_=n("2877");function S(e){this["$style"]=$["default"].locals||$["default"]}var z=Object(_["a"])(j,g,y,!1,S,null,null),C=z.exports,R=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(i["a"])(this,Object(s["a"])(t).apply(this,arguments)),e.totalCount=0,e.tableData=[],e.maxHeight=100,e.colCfg=[],e.pageSize=10,e.page=1,e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){this.getData(1,10)}},{key:"mounted",value:function(){this.getMaxHeight()}},{key:"getData",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,n){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.pageSize=n,this.page=t,e.next=4,this.fetch(t,n);case 4:a=e.sent,this.totalCount=a.count,this.tableData=a.data;case 7:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"toExcel",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.bodyStr();case 2:t=e.sent,v(this.headStr()+t);case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"fetch",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",{count:0,data:[]});case 1:case"end":return e.stop()}},e)}));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"refresh",value:function(e){null==e&&(e=this.tableData.length>1?this.page:this.page-1),this.getData(Math.max(1,e),this.pageSize)}},{key:"getMaxHeight",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs.table,!t){e.next=13;break}if(n=t.$el||t,!n){e.next=13;break}return e.prev=4,e.next=7,Object(f["e"])(function(){return!!n.offsetHeight});case 7:this.maxHeight=.85*n.offsetHeight,e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](4),console.log(e.t0);case 13:case"end":return e.stop()}},e,this,[[4,10]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"headStr",value:function(){var e=["<thead><tr>"];return this.colCfg.forEach(function(t){return e.push("<th>".concat(t.label,"</th>"))}),e.push("</tr></thead>"),e.join("")}},{key:"bodyStr",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(1,this.totalCount);case 2:return t=e.sent.data,n=["<tbody>"],t.forEach(function(e){n.push("<tr>"),a.colCfg.forEach(function(t){return n.push("<td>".concat(e[t.prop],"</td>"))}),n.push("</tr>")}),n.push("</tbody>"),e.abrupt("return",n.join(""));case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}]),t}(u["default"]);l["a"]([Object(h["c"])("$store.state.rootScale")],R.prototype,"getMaxHeight",null),R=l["a"]([Object(p["b"])({components:{"app-table":C}})],R);t["a"]=R},b1fa:function(e,t,n){"use strict";var a=n("1422"),r=n.n(a);t["default"]=r.a},ba16:function(e,t,n){var a=n("5ca1"),r=n("11e9").f,o=n("cb7c");a(a.S,"Reflect",{deleteProperty:function(e,t){var n=r(o(e),t);return!(n&&!n.configurable)&&delete e[t]}})},c8bb:function(e,t,n){e.exports=n("54a1")},d2d5:function(e,t,n){n("1654"),n("549b"),e.exports=n("584a").Array.from},fc9b:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.$style.box},[n("div",{class:e.$style["tool-bar"]},[n("map-select",{staticStyle:{"margin-left":"50px"},on:{selectmap:e.selectMap}})],1),n("div",{ref:"map",staticStyle:{height:"100%",overflow:"hidden"}}),n("el-collapse",{class:e.$style.op,model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[n("el-collapse-item",{attrs:{name:"info",title:"区域信息"}},[n("app-table",{class:e.$style.table,attrs:{"max-height":255,"table-data":e.tableData,"col-cfg":e.colCfg,"total-count":e.totalCount,op:e.op,"op-width":150,noPrint:!0,isSmall:!0},on:{updateData:e.getData,del:e.del,display:e.display}})],1),n("el-collapse-item",{attrs:{title:"添加区域",name:"add"}},[n("el-form",{ref:"form",class:e.$style.form,style:{"max-height":e.formHeight},attrs:{model:e.form,"label-width":"90px"}},[n("el-form-item",{attrs:{label:"区域名称",required:""}},[n("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("el-form-item",{attrs:{label:"区域模式"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.mode,callback:function(t){e.$set(e.form,"mode",t)},expression:"form.mode"}},[n("el-option",{attrs:{label:"进入区域",value:0}}),n("el-option",{attrs:{label:"离开区域",value:1}})],1)],1),e._l(e.form.position,function(t,a){return n("el-form-item",{key:a,attrs:{label:"区域坐标"+(a+1)}},[n("el-button",{attrs:{type:t?"warning":"success",size:"mini"},on:{click:function(n){return e.setPosition(t,a)}}},[e._v("\n                        "+e._s(t?"删除":"设置")+"\n                    ")]),n("span",{staticClass:"ellipsis",class:e.$style.point},[e._v("\n                        "+e._s(t?JSON.stringify(t):"")+"\n                    ")])],1)}),n("el-form-item",{attrs:{label:"启动"}},[n("el-switch",{attrs:{"active-text":"true","inactive-text":"false"},model:{value:e.form.open,callback:function(t){e.$set(e.form,"open",t)},expression:"form.open"}})],1)],2),n("el-button",{class:e.$style.submit,attrs:{type:"success"},on:{click:e.onSubmit}},[e._v("\n                提交\n            ")])],1)],1)],1)},r=[],o=(n("ba16"),n("ac6a"),n("75fc")),i=(n("7f7f"),n("96cf"),n("3b8d")),s=n("d225"),c=n("b0b4"),l=n("308d"),u=n("6bb5"),p=n("4e2b"),f=n("9ab4"),h=n("2fe1"),d=n("ae85"),m=n("99d1"),b=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(l["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.activeNames=["info","add"],e.colCfg=[{prop:"name",label:"区域",sortable:!0,width:90},{prop:"status",label:"状态",width:60}],e.op=[{type:"danger",name:"del",desc:"删除"},{type:{default:"primary"},name:"display",desc:{default:"显示"}}],e.form={name:"",mode:0,position:[null],open:!1},e.pointIndex=-1,e}return Object(p["a"])(t,e),Object(c["a"])(t,[{key:"del",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$confirm("确认删除区域".concat(t.name,"?"),"确认删除");case 3:return e.next=5,this.$http.post("/api/zone/deleteZone",{id:t.id});case 5:this.$message.success("删除成功"),this.refresh(),this.display(t,n,!0),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),console.log(e.t0);case 13:case"end":return e.stop()}},e,this,[[0,10]])}));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"display",value:function(e,t,n){var a=this.op[1];a.type[t]||n?(a.type[t]=void 0,this.mgr&&this.mgr.remove(e.name)):(a.type[t]="success",this.mgr&&this.mgr.zoneOpen(e)),a.desc[t]=a.desc[t]||n?void 0:"隐藏",this.$set(this.op,1,a)}},{key:"setPosition",value:function(e,t){var n=this.form.position.indexOf(e);e&&n>-1?(this.form.position.splice(n,1),this.mgr.remove(JSON.stringify(e))):this.pointIndex=t}},{key:"onSubmit",value:function(){var e=this;if(!this.form.name.length)return this.$message.warning("区域名称必填");if(this.form.position.length<4)return this.$message.warning("区域坐标最少设置3个");var t=Object(o["a"])(this.form.position);t.pop();var n=Date.now(),a={id:0,position:t,name:this.form.name,enable:this.form.open?1:0,createTime:n,updateime:n};this.mgr.createPolygonMarker(t,a.name,!0),setTimeout(function(){e.$confirm("请确定当前区域范围","提示",{type:"info"}).then(function(){return t.forEach(e.setPosition,e),e.mgr?(a.position=JSON.stringify(t.map(function(t){return e.mgr.getCoordinate(t)})),Reflect.deleteProperty(a,"id"),e.$http.post("/api/zone/addZone",a,{"Content-Type":"application/json"})):(e.$message.error("地图不存在, 提交失败!"),Promise.reject("地图不存在"))}).then(function(){e.$message.success("添加成功"),e.refresh(e.page),e.$refs.form.resetFields()}).catch(console.log).finally(function(){e.mgr&&e.mgr.remove(a.name)})},1e3)}},{key:"fetch",value:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,n){var a,r,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=[],r=0,e.prev=2,e.next=5,this.$http.get("/api/zone/getall",{pageSize:n,currentPage:t});case 5:o=e.sent,a=o.pagedData.datas.map(function(e){return e.status=e.enable?"开启":"关闭",e.position=JSON.parse(e.position),e}),r=o.pagedData.totalCount,e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),console.log(e.t0);case 13:return e.abrupt("return",{count:r,data:a});case 14:case"end":return e.stop()}},e,this,[[2,10]])}));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"bindEvents",value:function(){var e=this;this.mgr.on("mapClickNode",function(t){if(t.nodeType!==fengmap.FMNodeType.NONE&&e.pointIndex>-1){var n=t.eventInfo.coord,a=e.mgr.addImage({x:n.x,y:n.y,url:"/images/blueImageMarker.png",size:32,height:2});e.$set(e.form.position,e.pointIndex,a),e.pointIndex=-1,e.form.position.push(null)}})}},{key:"formHeight",get:function(){return"calc(".concat(100/this.$store.state.rootScale,"vh - 500px)")}}]),t}(Object(h["c"])(d["a"],m["a"]));b=f["a"]([h["b"]],b);var v=b,g=v,y=n("b1fa"),x=n("2877");function w(e){this["$style"]=y["default"].locals||y["default"]}var k=Object(x["a"])(g,a,r,!1,w,null,null);t["default"]=k.exports}}]);
//# sourceMappingURL=system1.6d2b7ace.js.map