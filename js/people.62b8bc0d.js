(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["people"],{"0a49":function(e,t,a){var r=a("9b43"),n=a("626a"),i=a("4bf8"),o=a("9def"),s=a("cd1c");e.exports=function(e,t){var a=1==e,l=2==e,c=3==e,p=4==e,u=6==e,d=5==e||u,f=t||s;return function(t,s,m){for(var v,g,h=i(t),b=n(h),y=r(s,m,3),w=o(b.length),x=0,$=a?f(t,w):l?f(t,0):void 0;w>x;x++)if((d||x in b)&&(v=b[x],g=y(v,x,h),e))if(a)$[x]=g;else if(g)switch(e){case 3:return!0;case 5:return v;case 6:return x;case 2:$.push(v)}else if(p)return!1;return u?-1:c||p?p:$}}},"2ddd":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"main"},[a("div",{staticStyle:{"overflow-y":"auto"},style:{height:e.mainHeight}},[a("router-view")],1)]),a("app-aside",{attrs:{tabs:e.tabs}})],1)},n=[],i=a("d225"),o=a("308d"),s=a("6bb5"),l=a("4e2b"),c=a("9ab4"),p=a("2fe1"),u=a("3d13"),d=a("cda1"),f=a("2b0e"),m=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(o["a"])(this,Object(s["a"])(t).apply(this,arguments)),e.tabs=[{title:"标签列表",to:"list",icon:"el-icon-user",children:[{title:"常驻标签",to:"/people/list/1",icon:"el-icon-user-solid"},{title:"临时标签",to:"/people/list/2",icon:"el-icon-s-custom"}]},{title:"标签添加",to:"/people/add",icon:"el-icon-document-add"}],e}return Object(l["a"])(t,e),t}(f["default"]);c["a"]([Object(d["a"])("mainHeight")],m.prototype,"mainHeight",void 0),m=c["a"]([Object(p["b"])({components:{"app-aside":u["a"]}})],m);var v=m,g=v,h=a("2877"),b=Object(h["a"])(g,r,n,!1,null,null,null);t["default"]=b.exports},"42de":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{attrs:{filterable:"","default-first-option":"",multiple:!!e.multiple,disabled:!!e.disabled,"collapse-tags":""},on:{change:e.change},model:{value:e.currValue,callback:function(t){e.currValue=t},expression:"currValue"}},e._l(e.options,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)},n=[],i=(a("7514"),a("7f7f"),a("ac6a"),a("d225")),o=a("b0b4"),s=a("308d"),l=a("6bb5"),c=a("4e2b"),p=a("9ab4"),u=a("2b0e"),d=a("2fe1"),f=a("60a3"),m=function(e){function t(){var e;return Object(i["a"])(this,t),e=Object(s["a"])(this,Object(l["a"])(t).apply(this,arguments)),e.options=[],e.currValue=null,e}return Object(c["a"])(t,e),Object(o["a"])(t,[{key:"created",value:function(){var e=this;this.$http.get(this.url,{pageSize:1e6,currentPage:1}).then(function(t){e.options=t.pagedData.datas.map(function(t){return{id:t[e.keys.id||"id"],name:t[e.keys.name],data:t}}),e.multiple?e.currValue=[]:e.currValue=null==e.value||""===e.value?e.options[0].id:e.value,e.change(e.currValue)}).catch(console.error)}},{key:"change",value:function(e){var t=this;this.$emit("input",e),Array.isArray(e)||(e=[e]),this.$emit("change",e.map(function(e){return t.options.find(function(t){return t.id===e})}))}}]),t}(u["default"]);p["a"]([Object(f["d"])()],m.prototype,"url",void 0),p["a"]([Object(f["d"])()],m.prototype,"value",void 0),p["a"]([Object(f["d"])({default:function(){return{id:"id",name:"name"}}})],m.prototype,"keys",void 0),p["a"]([Object(f["d"])()],m.prototype,"multiple",void 0),p["a"]([Object(f["d"])()],m.prototype,"disabled",void 0),m=p["a"]([d["b"]],m);var v=m,g=v,h=a("2877"),b=Object(h["a"])(g,r,n,!1,null,null,null);t["a"]=b.exports},7514:function(e,t,a){"use strict";var r=a("5ca1"),n=a("0a49")(5),i="find",o=!0;i in[]&&Array(1)[i](function(){o=!1}),r(r.P+r.F*o,"Array",{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(i)},8346:function(e,t,a){"use strict";a.r(t);var r=function(){var e,t,a,r=this,n=r.$createElement,i=r._self._c||n;return i("div",{staticStyle:{"padding-left":"5%","padding-top":"3%"}},[i("h3",{staticStyle:{color:"#009688"}},[r._v("添加标签")]),i("el-form",{ref:"form",staticStyle:{width:"80%"},attrs:{model:r.form,"label-width":"auto"}},[i("el-form-item",{attrs:{label:"头像："}},[i("div",{on:{click:r.selectAvator}},[i("el-tooltip",{attrs:{effect:"dark",content:"人员",placement:"bottom-end"}},[i("el-image",{class:(e={},e[r.$style.avatar]=!0,e[r.$style.selected]=0===r.imgIndex,e),attrs:{src:"/images/P.png",fit:"contain","data-index":"0"}})],1),i("el-tooltip",{attrs:{effect:"dark",content:"物品",placement:"bottom-end"}},[i("el-image",{class:(t={},t[r.$style.avatar]=!0,t[r.$style.selected]=1===r.imgIndex,t),attrs:{src:"/images/item.png",fit:"contain","data-index":"1"}})],1),i("el-tooltip",{attrs:{effect:"dark",content:"自定义",placement:"bottom-end"}},[i("el-image",{class:(a={},a[r.$style.avatar]=!0,a[r.$style.selected]=2===r.imgIndex,a),attrs:{src:r.form.avatar||"/images/true.png",fit:"contain","data-index":"2"}})],1)],1)]),i("el-form-item",{attrs:{label:"标签名称：",prop:"name",required:""}},[i("el-input",{model:{value:r.form.name,callback:function(e){r.$set(r.form,"name",e)},expression:"form.name"}})],1),i("el-form-item",{attrs:{label:"标签号：",prop:"tagNo",required:"",rules:{pattern:/^[0-9A-Fa-f]{8}$/,message:"tagNo is not a hexadecimal string of length 8"}}},[i("el-input",{model:{value:r.form.tagNo,callback:function(e){r.$set(r.form,"tagNo",e)},expression:"form.tagNo"}})],1),i("el-form-item",{attrs:{label:"区域: "}},[i("app-select",{attrs:{url:"/api/zone/getall"},model:{value:r.form.zone,callback:function(e){r.$set(r.form,"zone",e)},expression:"form.zone"}})],1),i("el-form-item",{attrs:{label:"其他属性："}},[i("el-input",{attrs:{placeholder:"性别: 女, 部门: 研发"},model:{value:r.form.properties,callback:function(e){r.$set(r.form,"properties",e)},expression:"form.properties"}})],1),i("el-form-item",{attrs:{label:"标签类型：",prop:"type"}},[i("el-radio-group",{model:{value:r.form.type,callback:function(e){r.$set(r.form,"type",e)},expression:"form.type"}},[i("el-radio",{attrs:{label:1}},[r._v("常驻")]),i("el-radio",{attrs:{label:2}},[r._v("临时")])],1)],1),2===r.form.type?i("el-form-item",{attrs:{label:"添加原因："}},[i("el-input",{model:{value:r.form.reason,callback:function(e){r.$set(r.form,"reason",e)},expression:"form.reason"}})],1):r._e(),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:r.onSubmit}},[r._v("立即创建")]),i("el-button",{on:{click:r.reset}},[r._v("重置")])],1)],1),i("el-dialog",{class:r.$style.model,attrs:{visible:r.visible,"modal-append-to-body":!1,width:"70%",top:"5vh",title:"裁剪头像"},on:{"update:visible":function(e){r.visible=e}}},[i("div",{staticClass:"el-divider el-divider--horizontal",class:r.$style.divider}),i("div",{class:r.$style.btn},[i("span",{staticStyle:{"margin-right":"20px"}},[r._v("本地上传")]),i("el-upload",{attrs:{accept:"image/jpeg, image/png","auto-upload":!1,action:"","show-file-list":!1,"on-change":r.changeUpload}},[i("el-button",{attrs:{size:"small",type:"primary"}},[r._v("选择文件")])],1)],1),i("el-row",{staticStyle:{margin:"20px 0"}},[i("el-col",{staticStyle:{height:"400px"},attrs:{span:16,xs:24}},[r.url?i("VueCropper",{ref:"cropper",attrs:{img:r.url,autoCrop:!0,fixed:!0,fixedNumber:[1,1]},on:{realTime:r.realTime}}):i("el-upload",{staticClass:"avatar-upload",attrs:{drag:"",accept:"image/jpeg, image/png","auto-upload":!1,action:"","show-file-list":!1,"on-change":r.changeUpload}},[i("div",{class:r.$style.center},[i("div",[i("i",{staticClass:"el-icon-upload"}),i("div",{class:r.$style.tip},[r._v("\r\n                                将文件拖到此处，或\r\n                                "),i("em",{staticStyle:{color:"#66ccff"}},[r._v("选择文件")])]),i("div",{class:r.$style.tip},[r._v("\r\n                                只能上传jpg/png文件，且不超过5M\r\n                            ")])])])])],1),i("el-col",{attrs:{span:7,xs:23,offset:1}},[i("el-row",[i("el-col",{class:r.$style.preview,style:Object.assign({},r.previewBox,{zoom:200/r.preview.w}),attrs:{span:24,xs:10}},[i("div",{style:r.preview.div},[i("img",{style:r.preview.img,attrs:{src:r.preview.url}})])]),i("el-col",{class:r.$style.preview,style:Object.assign({},r.previewBox,{zoom:100/r.preview.w}),attrs:{span:24,ofsset:1,xs:8}},[i("div",{style:r.preview.div},[i("img",{style:r.preview.img,attrs:{src:r.preview.url}})])]),i("el-col",{class:r.$style.preview,style:Object.assign({},r.previewBox,{zoom:50/r.preview.w}),attrs:{span:24,ofsset:1,xs:4}},[i("div",{style:r.preview.div},[i("img",{style:r.preview.img,attrs:{src:r.preview.url}})])])],1)],1)],1),i("el-row",[i("el-col",{attrs:{span:6,xs:24}},[i("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:r.ok}},[r._v("确 定")])],1)],1)],1)],1)},n=[],i=a("768b"),o=(a("ac6a"),a("5df3"),a("7f7f"),a("d225")),s=a("b0b4"),l=a("308d"),c=a("6bb5"),p=a("4e2b"),u=a("9ab4"),d=a("2fe1"),f=a("2b0e"),m=a("42de"),v=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.url="",e.visible=!1,e.changeUpload=null,e.previewBox={width:"1024px",height:"1024px"},e.preview=null,e.imgIndex=0,e.form={type:1,reason:"",avatar:"",properties:""},e}return Object(p["a"])(t,e),Object(s["a"])(t,[{key:"created",value:function(){var e=this;this.changeUpload=function(t){if("image/png"!==t.raw.type&&"image/jpeg"!==t.raw.type)return e.$message.error("只能上传jpg/png文件!");if(t.size/1024/1024>5)return e.$message.error("上传文件大小不能超过 5MB!");var a=new FileReader;a.onload=function(t){e.url=t.target.result},a.readAsDataURL(t.raw)},this.preview={url:"/images/true.png",div:this.previewBox,w:1024}}},{key:"realTime",value:function(e){this.preview=e,this.previewBox={width:e.w+"px",height:e.h+"px"}}},{key:"ok",value:function(){var e=this,t=this.$refs.cropper;t?t.getCropData(function(t){e.form.avatar=t,e.$message.success("设置成功"),e.imgIndex=2,e.visible=!1}):this.$message.warning("请选择图片!!!")}},{key:"selectAvator",value:function(e){var t=e.target.dataset.index;t&&(+t<2?this.imgIndex=+t:2===+t&&(this.form.avatar&&(this.imgIndex=2),this.visible=!0))}},{key:"onSubmit",value:function(){var e=this,t=["/images/P.png","/images/item.png",this.form.avatar][this.imgIndex];this.$refs.form.validate().then(function(){var a=e.getcanvas(t,e.form.name).then(function(t){return e.$http.post("/api/tag/upload/tagPhoto",{tagPhoto:t.toDataURL("image/png",1)})}),r=Promise.resolve({code:200,message:"",pagedData:{currentPage:1,datas:[],pageSize:0,totalCount:0},success:!0,resultMap:{avatarUrl:t}});return e.imgIndex>1&&(r=e.getcanvas(t).then(function(t){return e.$http.post("/api/tag/upload/avatar",{avatar:t.toDataURL("image/png",1)})})),Promise.all([a,r])}).then(function(t){var a=Object(i["a"])(t,2),r=a[0],n=a[1],o=Date.now(),s=Object.assign({createTime:o,updateTime:o,updateUser:"string",createUser:"string",locked:!0,photo:r.resultMap.photoUrl},e.form);return s.avatar=n.resultMap.avatarUrl,e.$http.post("/api/tag/addTag",s,{"Content-Type":"application/json"})}).then(function(){e.$message.success("添加成功"),e.reset()}).catch(console.log)}},{key:"reset",value:function(){this.$refs.form.resetFields(),this.form.avatar=this.form.properties=""}},{key:"getcanvas",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document.createElement("canvas"),r=new Image;return r.src=e,new Promise(function(e,n){r.onload=function(){a.width=100,a.height=t?100:70;var n=a.getContext("2d");t&&("20px Arial"!==n.font&&(n.font="20px Arial"),"blue"!==n.strokeStyle&&(n.strokeStyle="blue"),"center"!==n.textAlign&&(n.textAlign="center"),n.fillText(t,50,80)),n.drawImage(r,25,10,50,50),e(a)},r.onerror=n})}}]),t}(f["default"]);v=u["a"]([Object(d["b"])({components:{"app-select":m["a"]}})],v);var g=v,h=g,b=a("a468"),y=(a("f582"),a("2877"));function w(e){this["$style"]=b["default"].locals||b["default"]}var x=Object(y["a"])(h,r,n,!1,w,null,null);t["default"]=x.exports},a468:function(e,t,a){"use strict";var r=a("c4ab"),n=a.n(r);t["default"]=n.a},c4ab:function(e,t,a){e.exports={avatar:"PeopleAdd_avatar_1etui",selected:"PeopleAdd_selected_21rSF",btn:"PeopleAdd_btn_11XCW",divider:"PeopleAdd_divider_1ZOlq",tip:"PeopleAdd_tip_Mj5IQ",center:"PeopleAdd_center_1F5UT",preview:"PeopleAdd_preview_gjrgb",model:"PeopleAdd_model_2vRVt"}},cd1c:function(e,t,a){var r=a("e853");e.exports=function(e,t){return new(r(e))(t)}},d944:function(e,t,a){},e853:function(e,t,a){var r=a("d3f4"),n=a("1169"),i=a("2b4c")("species");e.exports=function(e){var t;return n(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!n(t.prototype)||(t=void 0),r(t)&&(t=t[i],null===t&&(t=void 0))),void 0===t?Array:t}},f582:function(e,t,a){"use strict";var r=a("d944"),n=a.n(r);n.a},ffd2:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"5%",height:"100%"}},[a("el-card",{ref:"table",staticClass:"card"},[a("app-table",{attrs:{"max-height":e.maxHeight,"table-data":e.tableData,"col-cfg":e.colCfg,"total-count":e.totalCount,op:e.op,"op-width":200},on:{del:e.del,setting:e.setting,updateData:e.getData,toExcel:e.toExcel}})],1),e.person?[a("el-dialog",{attrs:{title:"更改标签信息",visible:!!e.person,"modal-append-to-body":!1},on:{close:function(t){e.person=null}}},[a("el-form",{attrs:{model:e.person,"label-width":"auto"}},[a("el-form-item",{attrs:{label:"名称",required:"",prop:"name"}},[a("el-input",{staticStyle:{width:"80%"},model:{value:e.person.name,callback:function(t){e.$set(e.person,"name",t)},expression:"person.name"}})],1),a("el-form-item",{attrs:{label:"区域"}},[a("el-select",{model:{value:e.person.zone,callback:function(t){e.$set(e.person,"zone",t)},expression:"person.zone"}},e._l(e.zones.pagedData.datas,function(e){return a("el-option",{key:e.id,attrs:{value:e.id+"",label:e.name}})}),1)],1),a("el-form-item",{attrs:{label:"属性"}},[a("el-input",{attrs:{placeholder:"性别: 女, 部门: 研发"},model:{value:e.person.properties,callback:function(t){e.$set(e.person,"properties",t)},expression:"person.properties"}})],1)],1),a("template",{slot:"footer"},[a("el-button",{on:{click:function(t){e.person=null}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],2)]:e._e()],2)},n=[],i=(a("7514"),a("ac6a"),a("5df3"),a("768b")),o=(a("96cf"),a("3b8d")),s=(a("7f7f"),a("d225")),l=a("b0b4"),c=a("308d"),p=a("6bb5"),u=a("4e2b"),d=a("9ab4"),f=a("2fe1"),m=a("ae85"),v=a("60a3"),g=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(c["a"])(this,Object(p["a"])(t).apply(this,arguments)),e.person=null,e.colCfg=[{prop:"id",label:"ID",sortable:!0,width:100},{prop:"name",label:"名称",width:120},{prop:"tagNo",label:"编号",width:120},{prop:"zoneName",label:"区域",width:120},{prop:"properties",label:"属性",width:200}],e}return Object(u["a"])(t,e),Object(l["a"])(t,[{key:"del",value:function(e){var t=this;this.$confirm("删除标签".concat(e.name,"?")).then(function(){return t.$http.post("/api/tag/deleteTag",{id:e.id})}).then(function(){t.$message.success("删除成功"),t.refresh()}).catch(console.log)}},{key:"setting",value:function(e){this.person=e}},{key:"submit",value:function(){var e=this;if(!this.person.name)return this.$message.warning("name is required!");this.person.updateTime=Date.now(),this.$confirm("确认修改?").then(function(){return e.$http.post("/api/tag/updateTag",e.person,{"Content-Type":"application/json"})}).then(function(){e.$message.success("修改成功"),e.refresh()}).catch(console.log)}},{key:"fetch",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t,a){var r,n,o,s,l,c,p=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=[],n=0,e.prev=2,e.next=5,Promise.all([this.$http.get("/api/tag/getall",{pageSize:a,currentPage:t,type:this.type||1}),Promise.resolve().then(function(){return p.zones||p.$http.get("/api/zone/getall",{pageSize:1e6,currentPage:1})})]);case 5:o=e.sent,s=Object(i["a"])(o,2),l=s[0],c=s[1],r=l.pagedData.datas.map(function(e){var t=c.pagedData.datas.find(function(t){return+t.id===+e.zone});return e.zoneName=t?t.name:"未知区域",e}),n=l.pagedData.totalCount,this.zones=c,e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](2),console.log(e.t0);case 17:return e.abrupt("return",{count:n,data:r});case 18:case"end":return e.stop()}},e,this,[[2,14]])}));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"routeUpdate",value:function(){this.getData(1,10)}},{key:"op",get:function(){var e=[];return this.permission.delete&&e.push({type:"danger",name:"del",desc:"删除"}),this.permission.put&&e.push({type:"primary",name:"setting",desc:"配置"}),e}}]),t}(Object(f["c"])(m["a"]));d["a"]([Object(v["d"])()],g.prototype,"type",void 0),d["a"]([Object(v["d"])()],g.prototype,"permission",void 0),d["a"]([Object(v["f"])("$route.params.type")],g.prototype,"routeUpdate",null),g=d["a"]([f["b"]],g);var h=g,b=h,y=a("2877"),w=Object(y["a"])(b,r,n,!1,null,null,null);t["default"]=w.exports}}]);
//# sourceMappingURL=people.62b8bc0d.js.map